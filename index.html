<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìºë¦­í„° í¬íŠ¸ë ˆì´íŠ¸ ì—ë””í„°</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            display: grid;
            grid-template-columns: 400px 1fr auto;
            gap: 20px;
            height: 100vh;
            box-sizing: border-box;
        }

        .control-panel {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 0;
            overflow-y: auto;
            height: calc(100vh - 40px);
        }

        .decoration-panel {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 0;
            overflow-y: auto;
            height: calc(100vh - 40px);
            width: 350px;
            display: block;
        }
        .decoration-panel.inactive {
            display: none;
        }

        .section-card {
            background-color: white;
            padding: 20px;
            border-radius: 12px;box-shadow
            : 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .control-panel h3 {
            margin: 0 0 16px 0;
            font-size: 1.1em;
            font-weight: 600;
            color: #2c3e50;
        }

        .input-group {
            margin-bottom: 16px;
        }
        .input-group:last-child {
            margin-bottom: 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9em;
            color: #495057;
        }
        
        .input-group-linked {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        .input-group-linked:last-child {
            margin-bottom: 0;
        }
        .input-group-linked label {
            flex-shrink: 0;
            width: 90px;
            margin: 0;
            font-weight: 500;
            font-size: 0.9em;
            color: #495057;
        }
        .input-group-linked input[type="range"] {
            flex-grow: 1;
            margin: 0;
        }
        .input-group-linked input[type="number"] {
            width: 45px;
            padding: 6px 8px;
            text-align: center;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9em;
        }
        .input-group-linked input[type="number"]:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .input-group input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 0.85em;
            background-color: #f8f9fa;
            cursor: pointer;
        }
        .input-group input[type="file"]:hover {
            border-color: #007bff;
            background-color: #e7f1ff;
        }

        .coordinate-inputs {
            display: block;
        }
        .coordinate-inputs .input-group-linked {
            margin-bottom: 10px;
        }
        .coordinate-inputs .input-group-linked label {
             width: 80px;
        }
        .coordinate-inputs .input-group-linked input[type="number"] {
            width: 70px;
        }

        #download-btn {
            width: 100%;
            padding: 14px;
            font-size: 1em;
            font-weight: 600;
            color: white;
            background:   #0056b3;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;        
        }
        #download-btn:hover {
            transform: translateY(-2px);        
        }
        #download-btn:active {
            transform: translateY(0);
        }
        
        /* ì²´í¬ë°•ìŠ¤ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 0;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .checkbox-group label {
            margin: 0 0 0 10px;
            font-weight: 500;
            font-size: 0.9em;
            color: #495057;
            cursor: pointer;
        }

        /* ì´ë¯¸ì§€ ì¸ë„¤ì¼ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 12px;
            max-height: 200px;
            overflow-y: auto;
            padding: 4px;
        }
        .image-preview-item {
            position: relative;
            width: 100%;
            padding-top: 100%;
            background-color: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        .image-preview-item img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-preview-item .remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background-color: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 2;
        }
        .image-preview-item .remove-btn:hover {
            background-color: #dc3545;
            transform: scale(1.1);
        }
        .image-preview-item .arrow-buttons {
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;
            z-index: 2;
        }
        .image-preview-item .arrow-btn {
            width: 24px;
            height: 24px;
            background-color: rgba(0, 123, 255, 0.9);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .image-preview-item .arrow-btn:hover {
            background-color: #007bff;
            transform: scale(1.1);
        }
        .image-preview-item .arrow-btn:disabled {
            background-color: rgba(108, 117, 125, 0.5);
            cursor: not-allowed;
        }
        .image-preview-item .arrow-btn:disabled:hover {
            transform: none;
        }
        .clear-all-btn {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            font-weight: 600;
            color: white;
            background-color: #dc3545;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;            
        }
        .clear-all-btn:hover {
            background-color: #c82333;
            transform: translateY(-2px);            
        }
        .clear-all-btn:active {
            transform: translateY(0);
        }

        .preview-area {
            background-color: #333;
            border-radius: 8px;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            height: calc(100vh - 40px);
            position: relative;
        }

        #sheet-canvas {
            background-color: white; /* í¸ì§‘ ì‹œì—ëŠ” í°ìƒ‰ìœ¼ë¡œ ë³´ì„ */
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            border: 1px dashed #aaa;
            transform-origin: center;
            max-width: none !important; /* ê°€ë¡œ í¬ê¸° ì œí•œ ì œê±° */
            min-width: 0; /* ìµœì†Œ ë„ˆë¹„ ì œí•œ ì œê±° */
            flex-shrink: 0; /* flex ì¶•ì†Œ ë°©ì§€ */
        }

        #bg-image-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            display: none;
        }

        #base-image-container {
            position: absolute;
            transform-origin: top left;
            z-index: 1;
        }
        #base-image {
            display: block;
            width: auto;
            height: auto;
        }
        #base-image:not([src]),
        #base-image[src=""] {
            display: none;
        }

        #grid-container {
            position: absolute;
            display: grid;
            cursor: move;
            z-index: 5;
        }

        .face-window {
            overflow: hidden;
            position: relative;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
        }
        .face-window.rounded {
            border-radius: 10px; /* ì˜ˆì‹œë¡œ 10px */
        }

        .face-sprite {
            position: absolute;
            display: block;
            width: auto;
            height: auto;
            transform-origin: top left;
        }
    </style>
</head>
<body>

    <div class="control-panel">
        <div class="section-card" style="background: linear-gradient(135deg, #aa0e0e 0%, #153cbb 100%); padding: 20px; margin-bottom: 20px;">
            <h2 style="margin: 0; color: white; font-size: 1.5em; font-weight: 700; text-align: center;">ìºë¦­í„° í¬íŠ¸ë ˆì´íŠ¸ ì—ë””í„°</h2>
        </div>

        <div class="section-card">
            <h3>ì´ë¯¸ì§€ í¬ê¸° ì„¤ì •</h3>
            <div class="checkbox-group" style="margin-bottom: 16px;">
                <input type="checkbox" id="enable-decoration" checked>
                <label for="enable-decoration">ê¸€ì ë° ë°°ê²½ ê¾¸ë¯¸ê¸° í™œì„±í™”</label>
            </div>
            <div class="input-group-linked">
                <label for="sheet-width">ê°€ë¡œ</label>
                <input type="range" id="sheet-width-slider" value="1200" min="100" max="4000">
                <input type="number" id="sheet-width" value="1200" min="100" max="4000">
            </div>
            <div class="input-group-linked">
                <label for="sheet-height">ì„¸ë¡œ</label>
                <input type="range" id="sheet-height-slider" value="1500" min="100" max="4000">
                <input type="number" id="sheet-height" value="1500" min="100" max="4000">
            </div>
            <div class="input-group-linked">
                <label for="preview-scale">ë¯¸ë¦¬ë³´ê¸° %</label>
                <input type="range" id="preview-scale-slider" value="50" min="30" max="100">
                <input type="number" id="preview-scale" value="60" min="30" max="100">
            </div>
        </div>

        <div class="section-card">
            <h3>ì „ì‹  ì´ë¯¸ì§€</h3>
            <div class="input-group">
                <label for="base-image-uploader">ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
                <input type="file" id="base-image-uploader" accept="image/*">
            </div>
            <div class="input-group-linked">
                <label for="base-image-x">X</label>
                <input type="range" id="base-image-x-slider" value="100" min="-1000" max="3000">
                <input type="number" id="base-image-x" value="100" min="-1000" max="3000">
            </div>
            <div class="input-group-linked">
                <label for="base-image-y">Y</label>
                <input type="range" id="base-image-y-slider" value="50" min="-1000" max="3000">
                <input type="number" id="base-image-y" value="50" min="-1000" max="3000">
            </div>
            <div class="input-group-linked">
                <label for="base-image-scale">í¬ê¸° %</label>
                <input type="range" id="base-image-scale-slider" value="100" min="10" max="300">
                <input type="number" id="base-image-scale" value="100" min="10" max="300">
            </div>
        </div>

        <div class="section-card">
            <h3>í‘œì • ì‹œíŠ¸ (ê·¸ë¦¬ë“œ)</h3>
            <p style="margin: 0 0 12px 0; color: #6c757d; font-size: 13px;">ğŸ’¡ ìœ„ì¹˜ëŠ” ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ë¡œë„ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
            <div class="input-group">
                <label for="face-grid-uploader">í‘œì • ì´ë¯¸ì§€ ì—…ë¡œë“œ (ë‹¤ì¤‘ ì„ íƒ)</label>
                <input type="file" id="face-grid-uploader" accept="image/*" multiple>
            </div>
            <div id="image-preview-list" class="image-preview-container"></div>
            <div class="input-group-linked">
                <label for="grid-x">ì‹œíŠ¸ X</label>
                <input type="range" id="grid-x-slider" value="700" min="0" max="4000">
                <input type="number" id="grid-x" value="700" min="0" max="4000">
            </div>
            <div class="input-group-linked">
                <label for="grid-y">ì‹œíŠ¸ Y</label>
                <input type="range" id="grid-y-slider" value="50" min="0" max="4000">
                <input type="number" id="grid-y" value="50" min="0" max="4000">
            </div>
            <div class="input-group-linked">
                <label for="grid-columns">ì—´ ê°œìˆ˜</label>
                <input type="range" id="grid-columns-slider" value="5" min="1" max="20">
                <input type="number" id="grid-columns" value="5" min="1" max="20">
            </div>
            <div class="input-group-linked">
                <label for="grid-gap">ê°„ê²© px</label>
                <input type="range" id="grid-gap-slider" value="10" min="0" max="100">
                <input type="number" id="grid-gap" value="10" min="0" max="100">
            </div>
            <div class="input-group-linked">
                <label for="grid-item-scale">ì´ë¯¸ì§€ ë°°ìœ¨ %</label>
                <input type="range" id="grid-item-scale-slider" value="100" min="10" max="300">
                <input type="number" id="grid-item-scale" value="100" min="10" max="300">
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="round-face-boxes">
                <label for="round-face-boxes">í‘œì • ë°•ìŠ¤ ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ</label>
            </div>

            <h3 style="margin-top: 24px;">ì–¼êµ´ ì˜ì—­ (ì „ì‹  ì´ë¯¸ì§€ ê¸°ì¤€)</h3>
            <div class="coordinate-inputs">
                <div class="input-group-linked">
                    <label for="face-x">X</label>
                    <input type="range" id="face-x-slider" value="150" min="-500" max="1000">
                    <input type="number" id="face-x" value="150" min="-500" max="1000">
                </div>
                <div class="input-group-linked">
                    <label for="face-y">Y</label>
                    <input type="range" id="face-y-slider" value="100" min="-500" max="1000">
                    <input type="number" id="face-y" value="100" min="-500" max="1000">
                </div>
                <div class="input-group-linked">
                    <label for="face-w">W</label>
                    <input type="range" id="face-w-slider" value="120" min="10" max="500">
                    <input type="number" id="face-w" value="120" min="10" max="500">
                </div>
                <div class="input-group-linked">
                    <label for="face-h">H</label>
                    <input type="range" id="face-h-slider" value="150" min="10" max="500">
                    <input type="number" id="face-h" value="150" min="10" max="500">
                </div>
            </div>
        </div>

        <div class="section-card">
            <h3>ì‹œíŠ¸ ì €ì¥</h3>
            <div class="input-group">
                <button id="download-btn">PNGë¡œ ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>

        <div class="section-card" style="text-align: center; padding: 16px;">
            <p style="margin: 0; font-size: 0.85em; color: #6c757d; line-height: 1.6;">
                ì—°ì—° | JUDGMENT
            </p>
            <p style="margin: 8px 0 0 0; font-size: 0.75em; color: #adb5bd;">
                <a href="https://x.com/EonType00" target="_blank" style="color: #0d6efd; text-decoration: none;">@EonType00</a>
            </p>
        </div>

        <div class="section-card">
            <div class="input-group">
                <button id="clear-all-images-btn" class="clear-all-btn">ëª¨ë“  ì´ë¯¸ì§€ ì´ˆê¸°í™”</button>
            </div>
            <!-- <div class="input-group" style="margin-top: 12px;">
                <button id="reset-settings-btn" class="clear-all-btn" style="background-color: #fd7e14;">ì„¤ì • ì´ˆê¸°í™”</button>
            </div> -->
        </div>
    </div>

    <div class="preview-area">
        <div id="sheet-canvas">
            <div id="bg-image-container"></div>
            <div id="base-image-container">
                <img id="base-image" src="" alt="ìºë¦­í„° ì „ì‹ ">
                </div>
            <div id="grid-container">
                </div>
        </div>
    </div>

    <div class="decoration-panel" id="decoration-panel">
        <div class="section-card">
            <h3>ë² ì´ìŠ¤ í°íŠ¸ ì„¤ì •</h3>
            <div class="input-group">
                <label for="global-font-source">í°íŠ¸ ì†ŒìŠ¤</label>
                <select id="global-font-source" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                    <option value="select">í°íŠ¸ ì„ íƒ</option>
                    <option value="custom">ì§ì ‘ ì…ë ¥</option>
                </select>
            </div>

            <div id="global-font-select" class="input-group">
                <label for="global-font-list">í°íŠ¸ ì„ íƒ</label>
                <select id="global-font-list" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                    <optgroup label="English">
                        <option value="Montserrat">Montserrat (ëª¬ì„¸ë¼íŠ¸)</option>
                        <option value="Lato">Lato (ë¼í† )</option>
                        <option value="Raleway">Raleway (ë ë¦¬ì›¨ì´)</option>
                        <option value="Oswald">Oswald (ì˜¤ìŠ¤ì™ˆë“œ)</option>
                        <option value="Merriweather">Merriweather (ë©”ë¦¬ì›¨ë”)</option>
                    </optgroup>
                    <optgroup label="í•œêµ­ì–´">
                        <option value="Noto Sans KR">Noto Sans KR (ë³¸ê³ ë”•)</option>
                        <option value="Noto Serif KR">Noto Serif KR (ë³¸ëª…ì¡°)</option>
                        <option value="Black Han Sans">Black Han Sans (ê²€ì€ê³ ë”•)</option>
                        <option value="Jua">Jua (ì£¼ì•„)</option>
                        <option value="Do Hyeon">Do Hyeon (ë„í˜„)</option>
                        <option value="Nanum Gothic">Nanum Gothic (ë‚˜ëˆ”ê³ ë”•)</option>
                        <option value="Nanum Myeongjo">Nanum Myeongjo (ë‚˜ëˆ”ëª…ì¡°)</option>
                        <option value="Nanum Pen Script">Nanum Pen Script (ë‚˜ëˆ”ì†ê¸€ì”¨ íœ)</option>
                        <option value="Nanum Brush Script">Nanum Brush Script (ë‚˜ëˆ”ì†ê¸€ì”¨ ë¶“)</option>
                        <option value="Gamja Flower">Gamja Flower (ê°ìê½ƒ)</option>
                        <option value="Poor Story">Poor Story (ê°€ë‚œí•œ ì´ì•¼ê¸°)</option>
                        <option value="Gothic A1">Gothic A1 (ê³ ë”• A1)</option>
                        <option value="Sunflower">Sunflower (í•´ë°”ë¼ê¸°)</option>
                        <option value="Stylish">Stylish (ìŠ¤íƒ€ì¼ë¦¬ì‰¬)</option>
                        <option value="East Sea Dokdo">East Sea Dokdo (ë™í•´ ë…ë„)</option>
                    </optgroup>
                    <optgroup label="æ—¥æœ¬èª">
                        <option value="Noto Sans JP">Noto Sans JP (ë³¸ê³ ë”• ì¼ë³¸ì–´)</option>
                        <option value="Noto Serif JP">Noto Serif JP (ë³¸ëª…ì¡° ì¼ë³¸ì–´)</option>
                        <option value="M PLUS Rounded 1c">M PLUS Rounded 1c (ì— í”ŒëŸ¬ìŠ¤ ë‘¥ê·¼)</option>
                        <option value="Kosugi Maru">Kosugi Maru (ì½”ìŠ¤ê¸° ë§ˆë£¨)</option>
                        <option value="Sawarabi Mincho">Sawarabi Mincho (ì‚¬ì™€ë¼ë¹„ ëª…ì¡°)</option>
                    </optgroup>
                    <optgroup label="ä¸­æ–‡">
                        <option value="Noto Sans SC">Noto Sans SC (ë³¸ê³ ë”• ê°„ì²´)</option>
                        <option value="Noto Sans TC">Noto Sans TC (ë³¸ê³ ë”• ë²ˆì²´)</option>
                        <option value="Noto Serif SC">Noto Serif SC (ë³¸ëª…ì¡° ê°„ì²´)</option>
                        <option value="Noto Serif TC">Noto Serif TC (ë³¸ëª…ì¡° ë²ˆì²´)</option>
                        <option value="Ma Shan Zheng">Ma Shan Zheng (ë§ˆì‚°ì •)</option>
                    </optgroup>
                </select>
            </div>

            <div id="global-custom-font-input" style="display: none;">
                <div class="input-group">
                    <label for="global-font-url">í°íŠ¸ URL</label>
                    <input type="text" id="global-font-url" placeholder="https://fonts.googleapis.com/css2?family=..." style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box; font-size: 0.85em;">
                </div>
                <div class="input-group">
                    <label for="global-font-family">í°íŠ¸ ì´ë¦„</label>
                    <input type="text" id="global-font-family" placeholder="Noto Sans KR" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box;">
                </div>
            </div>

            <details style="margin-top: 12px; padding: 12px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                <summary style="cursor: pointer; font-weight: 600; color: #495057; font-size: 0.9em; user-select: none;">ğŸ“– í°íŠ¸ ì§ì ‘ ì…ë ¥ ê°€ì´ë“œ</summary>
                <div style="margin-top: 12px; font-size: 0.85em; color: #495057; line-height: 1.6;">
                    <p style="margin: 0 0 12px 0; font-weight: 600; color: #212529;">ğŸ”¤ êµ¬ê¸€ í°íŠ¸ (Google Fonts) ì‚¬ìš©ë²•:</p>
                    <ol style="margin: 0 0 16px 0; padding-left: 20px;">
                        <li style="margin-bottom: 8px;">
                            <a href="https://fonts.google.com" target="_blank" style="color: #0d6efd; text-decoration: none;">fonts.google.com</a> ì ‘ì†
                        </li>
                        <li style="margin-bottom: 8px;">ì›í•˜ëŠ” í°íŠ¸ ì„ íƒ í›„ "Get font" í´ë¦­</li>
                        <li style="margin-bottom: 8px;">"Get embed code" í´ë¦­</li>
                        <li style="margin-bottom: 8px;">
                            <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">&lt;link&gt;</code> íƒœê·¸ì˜ <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">href</code> ë¶€ë¶„ì„ ë³µì‚¬í•˜ì—¬ "í°íŠ¸ URL"ì— ì…ë ¥
                            <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap</span>
                        </li>
                        <li style="margin-bottom: 8px;">
                            "CSS rules" ë¶€ë¶„ì˜ í°íŠ¸ ì´ë¦„ì„ "í°íŠ¸ ì´ë¦„"ì— ì…ë ¥
                            <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: Roboto</span>
                        </li>
                    </ol>

                    <p style="margin: 0 0 12px 0; font-weight: 600; color: #212529;">ğŸ‡°ğŸ‡· ëˆˆëˆ„ í°íŠ¸ (noonnu.cc) ì‚¬ìš©ë²•:</p>
                    <ol style="margin: 0 0 0 0; padding-left: 20px;">
                        <li style="margin-bottom: 8px;">
                            <a href="https://noonnu.cc" target="_blank" style="color: #0d6efd; text-decoration: none;">noonnu.cc</a> ì ‘ì†
                        </li>
                        <li style="margin-bottom: 8px;">ì›í•˜ëŠ” í°íŠ¸ ì„ íƒ í›„ "ì›¹í°íŠ¸ë¡œ ì‚¬ìš©" íƒ­ í´ë¦­</li>
                        <li style="margin-bottom: 8px;">
                            <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">@import</code> ë°©ì‹ì˜ URL ë¶€ë¶„ì„ ë³µì‚¬í•˜ì—¬ "í°íŠ¸ URL"ì— ì…ë ¥
                            <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2107@1.1/Pretendard-Regular.woff</span>
                        </li>
                        <li style="margin-bottom: 8px;">
                            <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">font-family</code> ë¶€ë¶„ì˜ í°íŠ¸ ì´ë¦„ì„ "í°íŠ¸ ì´ë¦„"ì— ì…ë ¥
                            <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: Pretendard-Regular</span>
                        </li>
                    </ol>

                    <p style="margin: 16px 0 0 0; padding: 8px; background: #fff3cd; border-left: 3px solid #ffc107; font-size: 0.85em;">
                        <strong>ğŸ’¡ íŒ:</strong> í°íŠ¸ê°€ ì ìš©ë˜ì§€ ì•Šìœ¼ë©´ URLê³¼ í°íŠ¸ ì´ë¦„ì´ ì •í™•í•œì§€ ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš”.
                    </p>
                </div>
            </details>

            <p style="margin: 12px 0 0 0; color: #6c757d; font-size: 12px;">ğŸ’¡ ì—¬ê¸°ì„œ ì„ íƒí•œ í°íŠ¸ê°€ ëª¨ë“  í…ìŠ¤íŠ¸ì— ì ìš©ë©ë‹ˆë‹¤</p>
        </div>

        <div class="section-card">
            <h3>ë°°ê²½ ì„¤ì •</h3>
            <div class="input-group">
                <label>ë°°ê²½ íƒ€ì…</label>
                <select id="bg-type" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                    <option value="transparent">íˆ¬ëª…</option>
                    <option value="color">ìƒ‰ìƒ</option>
                    <option value="image">ì´ë¯¸ì§€</option>
                </select>
            </div>
            <div id="bg-color-option" style="display: none;">
                <div class="input-group">
                    <label>ë°°ê²½ íƒ€ì…</label>
                    <select id="bg-color-type" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <option value="color">ìƒ‰ìƒ</option>
                        <option value="gradient">ê·¸ë¼ë°ì´ì…˜</option>
                    </select>
                </div>
                <div id="bg-color-single-option">
                    <div class="input-group">
                        <label for="bg-color">ë°°ê²½ ìƒ‰ìƒ</label>
                        <input type="color" id="bg-color" value="#ffffff" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                    </div>
                </div>
                <div id="bg-color-gradient-option" style="display: none;">
                    <div class="input-group">
                        <label style="font-weight: 500; font-size: 0.9em; color: #495057; margin-bottom: 8px;">ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ (ì‹œì‘ â†’ ë)</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="color" id="bg-color-gradient-start" value="#ffffff" style="flex: 1; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                            <input type="color" id="bg-color-gradient-end" value="#000000" style="flex: 1; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                        </div>
                    </div>
                </div>
            </div>
            <div id="bg-image-option" style="display: none;">
                <div class="input-group">
                    <label for="bg-image-uploader">ë°°ê²½ ì´ë¯¸ì§€</label>
                    <input type="file" id="bg-image-uploader" accept="image/*">
                </div>
                <div class="input-group">
                    <button id="clear-bg-image-btn" class="clear-all-btn" style="background-color: #6c757d; padding: 8px 12px; font-size: 0.85em;">ë°°ê²½ ì´ë¯¸ì§€ ì§€ìš°ê¸°</button>
                </div>
                <div class="input-group">
                    <label>ë² ì´ìŠ¤ íƒ€ì…</label>
                    <select id="bg-image-base-type" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <option value="color">ìƒ‰ìƒ</option>
                        <option value="gradient">ê·¸ë¼ë°ì´ì…˜</option>
                    </select>
                </div>
                <div id="bg-image-base-color-option">
                    <div class="input-group">
                        <label for="bg-image-base-color">ë² ì´ìŠ¤ ìƒ‰ìƒ</label>
                        <input type="color" id="bg-image-base-color" value="#ffffff" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                    </div>
                </div>
                <div id="bg-image-base-gradient-option" style="display: none;">
                    <div class="input-group">
                        <label style="font-weight: 500; font-size: 0.9em; color: #495057; margin-bottom: 8px;">ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ (ì‹œì‘ â†’ ë)</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="color" id="bg-image-gradient-start" value="#ffffff" style="flex: 1; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                            <input type="color" id="bg-image-gradient-end" value="#000000" style="flex: 1; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                        </div>
                    </div>
                </div>
                <div class="input-group-linked">
                    <label for="bg-image-x">X ìœ„ì¹˜</label>
                    <input type="range" id="bg-image-x-slider" value="0" min="-500" max="500">
                    <input type="number" id="bg-image-x" value="0" min="-500" max="500">
                </div>
                <div class="input-group-linked">
                    <label for="bg-image-y">Y ìœ„ì¹˜</label>
                    <input type="range" id="bg-image-y-slider" value="0" min="-500" max="500">
                    <input type="number" id="bg-image-y" value="0" min="-500" max="500">
                </div>
                <div class="input-group-linked">
                    <label for="bg-image-scale">í¬ê¸° %</label>
                    <input type="range" id="bg-image-scale-slider" value="100" min="10" max="300">
                    <input type="number" id="bg-image-scale" value="100" min="10" max="300">
                </div>
                <div class="input-group-linked">
                    <label for="bg-image-opacity">íˆ¬ëª…ë„ %</label>
                    <input type="range" id="bg-image-opacity-slider" value="100" min="0" max="100">
                    <input type="number" id="bg-image-opacity" value="100" min="0" max="100">
                </div>
            </div>
        </div>

        <div class="section-card">
            <h3>ìºë¦­í„° ì´ë¦„</h3>
            <div class="input-group">
                <label for="character-name">í…ìŠ¤íŠ¸</label>
                <input type="text" id="character-name" placeholder="ìºë¦­í„° ì´ë¦„ ì…ë ¥" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box;">
            </div>

            <div class="checkbox-group" style="margin-bottom: 12px;">
                <input type="checkbox" id="name-custom-font">
                <label for="name-custom-font">ê°œë³„ í°íŠ¸ ì‚¬ìš©</label>
            </div>

            <div id="name-font-settings" style="display: none;">
                <div class="input-group">
                    <label for="name-font-source">í°íŠ¸ ì†ŒìŠ¤</label>
                    <select id="name-font-source" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <option value="select">í°íŠ¸ ì„ íƒ</option>
                        <option value="custom">ì§ì ‘ ì…ë ¥</option>
                    </select>
                </div>

                <div id="name-font-select" class="input-group">
                    <label for="name-font-list">í°íŠ¸ ì„ íƒ</label>
                    <select id="name-font-list" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <optgroup label="English">
                            <option value="Montserrat">Montserrat (ëª¬ì„¸ë¼íŠ¸)</option>
                            <option value="Lato">Lato (ë¼í† )</option>
                            <option value="Raleway">Raleway (ë ë¦¬ì›¨ì´)</option>
                            <option value="Oswald">Oswald (ì˜¤ìŠ¤ì™ˆë“œ)</option>
                            <option value="Merriweather">Merriweather (ë©”ë¦¬ì›¨ë”)</option>
                        </optgroup>
                        <optgroup label="í•œêµ­ì–´">
                            <option value="Noto Sans KR">Noto Sans KR (ë³¸ê³ ë”•)</option>
                            <option value="Noto Serif KR">Noto Serif KR (ë³¸ëª…ì¡°)</option>
                            <option value="Black Han Sans">Black Han Sans (ê²€ì€ê³ ë”•)</option>
                            <option value="Jua">Jua (ì£¼ì•„)</option>
                            <option value="Do Hyeon">Do Hyeon (ë„í˜„)</option>
                            <option value="Nanum Gothic">Nanum Gothic (ë‚˜ëˆ”ê³ ë”•)</option>
                            <option value="Nanum Myeongjo">Nanum Myeongjo (ë‚˜ëˆ”ëª…ì¡°)</option>
                            <option value="Nanum Pen Script">Nanum Pen Script (ë‚˜ëˆ”ì†ê¸€ì”¨ íœ)</option>
                            <option value="Nanum Brush Script">Nanum Brush Script (ë‚˜ëˆ”ì†ê¸€ì”¨ ë¶“)</option>
                            <option value="Gamja Flower">Gamja Flower (ê°ìê½ƒ)</option>
                            <option value="Poor Story">Poor Story (ê°€ë‚œí•œ ì´ì•¼ê¸°)</option>
                            <option value="Gothic A1">Gothic A1 (ê³ ë”• A1)</option>
                            <option value="Sunflower">Sunflower (í•´ë°”ë¼ê¸°)</option>
                            <option value="Stylish">Stylish (ìŠ¤íƒ€ì¼ë¦¬ì‰¬)</option>
                            <option value="East Sea Dokdo">East Sea Dokdo (ë™í•´ ë…ë„)</option>
                        </optgroup>
                        <optgroup label="æ—¥æœ¬èª">
                            <option value="Noto Sans JP">Noto Sans JP (ë³¸ê³ ë”• ì¼ë³¸ì–´)</option>
                            <option value="Noto Serif JP">Noto Serif JP (ë³¸ëª…ì¡° ì¼ë³¸ì–´)</option>
                            <option value="M PLUS Rounded 1c">M PLUS Rounded 1c (ì— í”ŒëŸ¬ìŠ¤ ë‘¥ê·¼)</option>
                            <option value="Kosugi Maru">Kosugi Maru (ì½”ìŠ¤ê¸° ë§ˆë£¨)</option>
                            <option value="Sawarabi Mincho">Sawarabi Mincho (ì‚¬ì™€ë¼ë¹„ ëª…ì¡°)</option>
                        </optgroup>
                        <optgroup label="ä¸­æ–‡">
                            <option value="Noto Sans SC">Noto Sans SC (ë³¸ê³ ë”• ê°„ì²´)</option>
                            <option value="Noto Sans TC">Noto Sans TC (ë³¸ê³ ë”• ë²ˆì²´)</option>
                            <option value="Noto Serif SC">Noto Serif SC (ë³¸ëª…ì¡° ê°„ì²´)</option>
                            <option value="Noto Serif TC">Noto Serif TC (ë³¸ëª…ì¡° ë²ˆì²´)</option>
                            <option value="Ma Shan Zheng">Ma Shan Zheng (ë§ˆì‚°ì •)</option>
                        </optgroup>
                    </select>
                </div>

                <div id="name-custom-font-input" style="display: none;">
                    <div class="input-group">
                        <label for="name-font-url">í°íŠ¸ URL</label>
                        <input type="text" id="name-font-url" placeholder="https://fonts.googleapis.com/css2?family=..." style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box; font-size: 0.85em;">
                    </div>
                    <div class="input-group">
                        <label for="name-font-family">í°íŠ¸ ì´ë¦„</label>
                        <input type="text" id="name-font-family" placeholder="Noto Sans KR" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box;">
                    </div>

                    <details style="margin-top: 12px; padding: 12px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                        <summary style="cursor: pointer; font-weight: 600; color: #495057; font-size: 0.9em; user-select: none;">ğŸ“– í°íŠ¸ ì‚¬ìš© ê°€ì´ë“œ</summary>
                        <div style="margin-top: 12px; font-size: 0.85em; color: #495057; line-height: 1.6;">
                            <p style="margin: 0 0 12px 0; font-weight: 600; color: #212529;">ğŸ”¤ êµ¬ê¸€ í°íŠ¸ (Google Fonts) ì‚¬ìš©ë²•:</p>
                            <ol style="margin: 0 0 16px 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;">
                                    <a href="https://fonts.google.com" target="_blank" style="color: #0d6efd; text-decoration: none;">fonts.google.com</a> ì ‘ì†
                                </li>
                                <li style="margin-bottom: 8px;">ì›í•˜ëŠ” í°íŠ¸ ì„ íƒ í›„ "Get font" í´ë¦­</li>
                                <li style="margin-bottom: 8px;">"Get embed code" í´ë¦­</li>
                                <li style="margin-bottom: 8px;">
                                    <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">&lt;link&gt;</code> íƒœê·¸ì˜ <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">href</code> ë¶€ë¶„ì„ ë³µì‚¬í•˜ì—¬ ìœ„ "í°íŠ¸ URL"ì— ì…ë ¥
                                    <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap</span>
                                </li>
                                <li style="margin-bottom: 8px;">
                                    "CSS rules" ë¶€ë¶„ì˜ í°íŠ¸ ì´ë¦„ì„ "í°íŠ¸ ì´ë¦„"ì— ì…ë ¥
                                    <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: Roboto</span>
                                </li>
                            </ol>

                            <p style="margin: 0 0 12px 0; font-weight: 600; color: #212529;">ğŸ‡°ğŸ‡· ëˆˆëˆ„ í°íŠ¸ (noonnu.cc) ì‚¬ìš©ë²•:</p>
                            <ol style="margin: 0 0 0 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;">
                                    <a href="https://noonnu.cc" target="_blank" style="color: #0d6efd; text-decoration: none;">noonnu.cc</a> ì ‘ì†
                                </li>
                                <li style="margin-bottom: 8px;">ì›í•˜ëŠ” í°íŠ¸ ì„ íƒ í›„ "ì›¹í°íŠ¸ë¡œ ì‚¬ìš©" íƒ­ í´ë¦­</li>
                                <li style="margin-bottom: 8px;">
                                    <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">@import</code> ë°©ì‹ì˜ URL ë¶€ë¶„ì„ ë³µì‚¬í•˜ì—¬ ìœ„ "í°íŠ¸ URL"ì— ì…ë ¥
                                    <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2107@1.1/Pretendard-Regular.woff</span>
                                </li>
                                <li style="margin-bottom: 8px;">
                                    <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">font-family</code> ë¶€ë¶„ì˜ í°íŠ¸ ì´ë¦„ì„ "í°íŠ¸ ì´ë¦„"ì— ì…ë ¥
                                    <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: Pretendard-Regular</span>
                                </li>
                            </ol>

                            <p style="margin: 16px 0 0 0; padding: 8px; background: #fff3cd; border-left: 3px solid #ffc107; font-size: 0.85em;">
                                <strong>ğŸ’¡ íŒ:</strong> í°íŠ¸ê°€ ì ìš©ë˜ì§€ ì•Šìœ¼ë©´ URLê³¼ í°íŠ¸ ì´ë¦„ì´ ì •í™•í•œì§€ ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš”.
                            </p>
                        </div>
                    </details>
                </div>
            </div>

            <div class="input-group">
                <label for="name-align">í…ìŠ¤íŠ¸ ì •ë ¬</label>
                <select id="name-align" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                    <option value="left">ì™¼ìª½</option>
                    <option value="center">ì¤‘ì•™</option>
                    <option value="right">ì˜¤ë¥¸ìª½</option>
                </select>
            </div>

            <div class="input-group-linked">
                <label for="name-font-size">í¬ê¸°</label>
                <input type="range" id="name-font-size-slider" value="32" min="12" max="100">
                <input type="number" id="name-font-size" value="32" min="12" max="100">
            </div>
            <div class="input-group-linked">
                <label for="name-x">X</label>
                <input type="range" id="name-x-slider" value="20" min="0" max="1000">
                <input type="number" id="name-x" value="20" min="0" max="1000">
            </div>
            <div class="input-group-linked">
                <label for="name-y">Y</label>
                <input type="range" id="name-y-slider" value="20" min="0" max="1000">
                <input type="number" id="name-y" value="20" min="0" max="1000">
            </div>
            <div class="input-group">
                <label for="name-color">ìƒ‰ìƒ</label>
                <input type="color" id="name-color" value="#333333" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
            </div>
            
            <div class="input-group">
                <label for="name-font-weight">ê¸€ê¼´ êµµê¸°</label>
                <select id="name-font-weight" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                    <option value="normal">Normal (400)</option>
                    <option value="bold" selected>Bold (700)</option>
                    <option value="100">Thin (100)</option>
                    <option value="300">Light (300)</option>
                    <option value="500">Medium (500)</option>
                    <option value="900">Black (900)</option>
                </select>
            </div>

            <div class="input-group">
                <div class="checkbox-group" style="padding: 0; background: none;">
                    <input type="checkbox" id="name-shadow-enable">
                    <label for="name-shadow-enable">í…ìŠ¤íŠ¸ ê·¸ë¦¼ì</label>
                </div>
                <div id="name-shadow-options" style="display: none; margin-top: 10px;">
                    <div class="input-group-linked">
                        <label for="name-shadow-x">X</label>
                        <input type="range" id="name-shadow-x-slider" value="2" min="-10" max="10">
                        <input type="number" id="name-shadow-x" value="2" min="-10" max="10">
                    </div>
                    <div class="input-group-linked">
                        <label for="name-shadow-y">Y</label>
                        <input type="range" id="name-shadow-y-slider" value="2" min="-10" max="10">
                        <input type="number" id="name-shadow-y" value="2" min="-10" max="10">
                    </div>
                    <div class="input-group-linked">
                        <label for="name-shadow-blur">íë¦¼</label>
                        <input type="range" id="name-shadow-blur-slider" value="4" min="0" max="20">
                        <input type="number" id="name-shadow-blur" value="4" min="0" max="20">
                    </div>
                    <label for="name-shadow-color" style="font-weight: 500; font-size: 0.9em; color: #495057; margin-bottom: 8px; margin-top: 10px;">ìƒ‰ìƒ</label>
                    <input type="color" id="name-shadow-color" value="#FFFFFF" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                </div>
            </div>

            <div class="input-group">
                <div class="checkbox-group" style="padding: 0; background: none;">
                    <input type="checkbox" id="name-stroke-enable">
                    <label for="name-stroke-enable">í…ìŠ¤íŠ¸ ì™¸ê³½ì„ </label>
                </div>
                <div id="name-stroke-options" style="display: none; margin-top: 10px;">
                    <div class="input-group-linked">
                        <label for="name-stroke-width">ë‘ê»˜</label>
                        <input type="range" id="name-stroke-width-slider" value="1" min="1" max="5">
                        <input type="number" id="name-stroke-width" value="1" min="1" max="5">
                    </div>
                    <label for="name-stroke-color" style="font-weight: 500; font-size: 0.9em; color: #495057; margin-bottom: 8px; margin-top: 10px;">ìƒ‰ìƒ</label>
                    <input type="color" id="name-stroke-color" value="#000000" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                </div>
            </div>
        </div>

        <div class="section-card">
            <h3>ìºë¦­í„° ì„¤ëª…</h3>
            <div class="input-group">
                <label for="character-description">í…ìŠ¤íŠ¸</label>
                <textarea id="character-description" placeholder="ìºë¦­í„° ì„¤ëª… ì…ë ¥ (ì„ íƒì‚¬í•­)" style="width: 100%; height: 60px; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box; font-family: inherit; resize: vertical;"></textarea>
            </div>

            <div class="checkbox-group" style="margin-bottom: 12px;">
                <input type="checkbox" id="desc-custom-font">
                <label for="desc-custom-font">ê°œë³„ í°íŠ¸ ì‚¬ìš©</label>
            </div>

            <div id="desc-font-settings" style="display: none;">
                <div class="input-group">
                    <label for="desc-font-source">í°íŠ¸ ì†ŒìŠ¤</label>
                    <select id="desc-font-source" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <option value="select">í°íŠ¸ ì„ íƒ</option>
                        <option value="custom">ì§ì ‘ ì…ë ¥</option>
                    </select>
                </div>

                <div id="desc-font-select" class="input-group">
                    <label for="desc-font-list">í°íŠ¸ ì„ íƒ</label>
                    <select id="desc-font-list" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <optgroup label="English">
                            <option value="Montserrat">Montserrat (ëª¬ì„¸ë¼íŠ¸)</option>
                            <option value="Lato">Lato (ë¼í† )</option>
                            <option value="Raleway">Raleway (ë ë¦¬ì›¨ì´)</option>
                            <option value="Oswald">Oswald (ì˜¤ìŠ¤ì™ˆë“œ)</option>
                            <option value="Merriweather">Merriweather (ë©”ë¦¬ì›¨ë”)</option>
                        </optgroup>
                        <optgroup label="í•œêµ­ì–´">
                            <option value="Noto Sans KR">Noto Sans KR (ë³¸ê³ ë”•)</option>
                            <option value="Noto Serif KR">Noto Serif KR (ë³¸ëª…ì¡°)</option>
                            <option value="Black Han Sans">Black Han Sans (ê²€ì€ê³ ë”•)</option>
                            <option value="Jua">Jua (ì£¼ì•„)</option>
                            <option value="Do Hyeon">Do Hyeon (ë„í˜„)</option>
                            <option value="Nanum Gothic">Nanum Gothic (ë‚˜ëˆ”ê³ ë”•)</option>
                            <option value="Nanum Myeongjo">Nanum Myeongjo (ë‚˜ëˆ”ëª…ì¡°)</option>
                            <option value="Nanum Pen Script">Nanum Pen Script (ë‚˜ëˆ”ì†ê¸€ì”¨ íœ)</option>
                            <option value="Nanum Brush Script">Nanum Brush Script (ë‚˜ëˆ”ì†ê¸€ì”¨ ë¶“)</option>
                            <option value="Gamja Flower">Gamja Flower (ê°ìê½ƒ)</option>
                            <option value="Poor Story">Poor Story (ê°€ë‚œí•œ ì´ì•¼ê¸°)</option>
                            <option value="Gothic A1">Gothic A1 (ê³ ë”• A1)</option>
                            <option value="Sunflower">Sunflower (í•´ë°”ë¼ê¸°)</option>
                            <option value="Stylish">Stylish (ìŠ¤íƒ€ì¼ë¦¬ì‰¬)</option>
                            <option value="East Sea Dokdo">East Sea Dokdo (ë™í•´ ë…ë„)</option>
                        </optgroup>
                        <optgroup label="æ—¥æœ¬èª">
                            <option value="Noto Sans JP">Noto Sans JP (ë³¸ê³ ë”• ì¼ë³¸ì–´)</option>
                            <option value="Noto Serif JP">Noto Serif JP (ë³¸ëª…ì¡° ì¼ë³¸ì–´)</option>
                            <option value="M PLUS Rounded 1c">M PLUS Rounded 1c (ì— í”ŒëŸ¬ìŠ¤ ë‘¥ê·¼)</option>
                            <option value="Kosugi Maru">Kosugi Maru (ì½”ìŠ¤ê¸° ë§ˆë£¨)</option>
                            <option value="Sawarabi Mincho">Sawarabi Mincho (ì‚¬ì™€ë¼ë¹„ ëª…ì¡°)</option>
                        </optgroup>
                        <optgroup label="ä¸­æ–‡">
                            <option value="Noto Sans SC">Noto Sans SC (ë³¸ê³ ë”• ê°„ì²´)</option>
                            <option value="Noto Sans TC">Noto Sans TC (ë³¸ê³ ë”• ë²ˆì²´)</option>
                            <option value="Noto Serif SC">Noto Serif SC (ë³¸ëª…ì¡° ê°„ì²´)</option>
                            <option value="Noto Serif TC">Noto Serif TC (ë³¸ëª…ì¡° ë²ˆì²´)</option>
                            <option value="Ma Shan Zheng">Ma Shan Zheng (ë§ˆì‚°ì •)</option>
                        </optgroup>
                    </select>
                </div>

                <div id="desc-custom-font-input" style="display: none;">
                    <div class="input-group">
                        <label for="desc-font-url">í°íŠ¸ URL</label>
                        <input type="text" id="desc-font-url" placeholder="https://fonts.googleapis.com/css2?family=..." style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box; font-size: 0.85em;">
                    </div>
                    <div class="input-group">
                        <label for="desc-font-family-input">í°íŠ¸ ì´ë¦„</label>
                        <input type="text" id="desc-font-family-input" placeholder="Noto Sans KR" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box;">
                    </div>

                    <details style="margin-top: 12px; padding: 12px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                        <summary style="cursor: pointer; font-weight: 600; color: #495057; font-size: 0.9em; user-select: none;">ğŸ“– í°íŠ¸ ì‚¬ìš© ê°€ì´ë“œ</summary>
                        <div style="margin-top: 12px; font-size: 0.85em; color: #495057; line-height: 1.6;">
                            <p style="margin: 0 0 12px 0; font-weight: 600; color: #212529;">ğŸ”¤ êµ¬ê¸€ í°íŠ¸ (Google Fonts) ì‚¬ìš©ë²•:</p>
                            <ol style="margin: 0 0 16px 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;">
                                    <a href="https://fonts.google.com" target="_blank" style="color: #0d6efd; text-decoration: none;">fonts.google.com</a> ì ‘ì†
                                </li>
                                <li style="margin-bottom: 8px;">ì›í•˜ëŠ” í°íŠ¸ ì„ íƒ í›„ "Get font" í´ë¦­</li>
                                <li style="margin-bottom: 8px;">"Get embed code" í´ë¦­</li>
                                <li style="margin-bottom: 8px;">
                                    <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">&lt;link&gt;</code> íƒœê·¸ì˜ <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">href</code> ë¶€ë¶„ì„ ë³µì‚¬í•˜ì—¬ ìœ„ "í°íŠ¸ URL"ì— ì…ë ¥
                                    <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap</span>
                                </li>
                                <li style="margin-bottom: 8px;">
                                    "CSS rules" ë¶€ë¶„ì˜ í°íŠ¸ ì´ë¦„ì„ "í°íŠ¸ ì´ë¦„"ì— ì…ë ¥
                                    <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: Roboto</span>
                                </li>
                            </ol>

                            <p style="margin: 0 0 12px 0; font-weight: 600; color: #212529;">ğŸ‡°ğŸ‡· ëˆˆëˆ„ í°íŠ¸ (noonnu.cc) ì‚¬ìš©ë²•:</p>
                            <ol style="margin: 0 0 0 0; padding-left: 20px;">
                                <li style="margin-bottom: 8px;">
                                    <a href="https://noonnu.cc" target="_blank" style="color: #0d6efd; text-decoration: none;">noonnu.cc</a> ì ‘ì†
                                </li>
                                <li style="margin-bottom: 8px;">ì›í•˜ëŠ” í°íŠ¸ ì„ íƒ í›„ "ì›¹í°íŠ¸ë¡œ ì‚¬ìš©" íƒ­ í´ë¦­</li>
                                <li style="margin-bottom: 8px;">
                                    <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">@import</code> ë°©ì‹ì˜ URL ë¶€ë¶„ì„ ë³µì‚¬í•˜ì—¬ ìœ„ "í°íŠ¸ URL"ì— ì…ë ¥
                                    <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2107@1.1/Pretendard-Regular.woff</span>
                                </li>
                                <li style="margin-bottom: 8px;">
                                    <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 0.9em;">font-family</code> ë¶€ë¶„ì˜ í°íŠ¸ ì´ë¦„ì„ "í°íŠ¸ ì´ë¦„"ì— ì…ë ¥
                                    <br><span style="color: #6c757d; font-size: 0.9em;">ì˜ˆ: Pretendard-Regular</span>
                                </li>
                            </ol>

                            <p style="margin: 16px 0 0 0; padding: 8px; background: #fff3cd; border-left: 3px solid #ffc107; font-size: 0.85em;">
                                <strong>ğŸ’¡ íŒ:</strong> í°íŠ¸ê°€ ì ìš©ë˜ì§€ ì•Šìœ¼ë©´ URLê³¼ í°íŠ¸ ì´ë¦„ì´ ì •í™•í•œì§€ ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš”.
                            </p>
                        </div>
                    </details>
                </div>
            </div>

            <div class="input-group">
                <label for="desc-align">í…ìŠ¤íŠ¸ ì •ë ¬</label>
                <select id="desc-align" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                    <option value="left">ì™¼ìª½</option>
                    <option value="center">ì¤‘ì•™</option>
                    <option value="right">ì˜¤ë¥¸ìª½</option>
                </select>
            </div>

            <div class="input-group-linked">
                <label for="desc-font-size">í¬ê¸°</label>
                <input type="range" id="desc-font-size-slider" value="16" min="8" max="48">
                <input type="number" id="desc-font-size" value="16" min="8" max="48">
            </div>
            <div class="input-group-linked">
                <label for="desc-x">X</label>
                <input type="range" id="desc-x-slider" value="20" min="0" max="2000">
                <input type="number" id="desc-x" value="20" min="0" max="2000">
            </div>
            <div class="input-group-linked">
                <label for="desc-y">Y</label>
                <input type="range" id="desc-y-slider" value="60" min="0" max="2000">
                <input type="number" id="desc-y" value="60" min="0" max="2000">
            </div>
            <div class="input-group">
                <label for="desc-color">ìƒ‰ìƒ</label>
                <input type="color" id="desc-color" value="#666666" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
            </div>
            <div class="input-group">
                <label for="desc-font-weight">ê¸€ê¼´ êµµê¸°</label>
                <select id="desc-font-weight" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                    <option value="normal" selected>Normal (400)</option>
                    <option value="bold">Bold (700)</option>
                    <option value="100">Thin (100)</option>
                    <option value="300">Light (300)</option>
                    <option value="500">Medium (500)</option>
                    <option value="900">Black (900)</option>
                </select>
            </div>
        </div>

        <div class="section-card">
            <h3>ì›Œí„°ë§ˆí¬</h3>
            <div class="input-group">
                <label for="watermark-text">í…ìŠ¤íŠ¸</label>
                <input type="text" id="watermark-text" placeholder="@artist_name" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box;">
            </div>

            <div class="input-group-linked">
                <label for="watermark-font-size">í¬ê¸°</label>
                <input type="range" id="watermark-font-size-slider" value="16" min="8" max="48">
                <input type="number" id="watermark-font-size" value="16" min="8" max="48">
            </div>

            <div class="input-group-linked">
                <label for="watermark-x">X</label>
                <input type="range" id="watermark-x-slider" value="20" min="0" max="2000">
                <input type="number" id="watermark-x" value="20" min="0" max="2000">
            </div>

            <div class="input-group-linked">
                <label for="watermark-y">Y</label>
                <input type="range" id="watermark-y-slider" value="20" min="0" max="2000">
                <input type="number" id="watermark-y" value="20" min="0" max="2000">
            </div>

            <div class="input-group">
                <label for="watermark-color">ìƒ‰ìƒ</label>
                <input type="color" id="watermark-color" value="#999999" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
            </div>

            <div class="input-group">
                <label for="watermark-font-weight">ê¸€ê¼´ êµµê¸°</label>
                <select id="watermark-font-weight" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                    <option value="normal" selected>Normal (400)</option>
                    <option value="bold">Bold (700)</option>
                    <option value="100">Thin (100)</option>
                    <option value="300">Light (300)</option>
                    <option value="500">Medium (500)</option>
                    <option value="900">Black (900)</option>
                </select>
            </div>

            <div class="input-group">
                <div class="checkbox-group" style="padding: 0; background: none;">
                    <input type="checkbox" id="watermark-shadow-enable">
                    <label for="watermark-shadow-enable">í…ìŠ¤íŠ¸ ê·¸ë¦¼ì</label>
                </div>
                <div id="watermark-shadow-options" style="display: none; margin-top: 10px;">
                    <div class="input-group-linked">
                        <label for="watermark-shadow-x">X</label>
                        <input type="range" id="watermark-shadow-x-slider" value="1" min="-10" max="10">
                        <input type="number" id="watermark-shadow-x" value="1" min="-10" max="10">
                    </div>
                    <div class="input-group-linked">
                        <label for="watermark-shadow-y">Y</label>
                        <input type="range" id="watermark-shadow-y-slider" value="1" min="-10" max="10">
                        <input type="number" id="watermark-shadow-y" value="1" min="-10" max="10">
                    </div>
                    <div class="input-group-linked">
                        <label for="watermark-shadow-blur">íë¦¼</label>
                        <input type="range" id="watermark-shadow-blur-slider" value="2" min="0" max="20">
                        <input type="number" id="watermark-shadow-blur" value="2" min="0" max="20">
                    </div>
                    <label for="watermark-shadow-color" style="font-weight: 500; font-size: 0.9em; color: #495057; margin-bottom: 8px; margin-top: 10px;">ìƒ‰ìƒ</label>
                    <input type="color" id="watermark-shadow-color" value="#FFFFFF" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                </div>
            </div>

            <div class="input-group">
                <div class="checkbox-group" style="padding: 0; background: none;">
                    <input type="checkbox" id="watermark-stroke-enable">
                    <label for="watermark-stroke-enable">í…ìŠ¤íŠ¸ ì™¸ê³½ì„ </label>
                </div>
                <div id="watermark-stroke-options" style="display: none; margin-top: 10px;">
                    <div class="input-group-linked">
                        <label for="watermark-stroke-width">ë‘ê»˜</label>
                        <input type="range" id="watermark-stroke-width-slider" value="1" min="1" max="5">
                        <input type="number" id="watermark-stroke-width" value="1" min="1" max="5">
                    </div>
                    <label for="watermark-stroke-color" style="font-weight: 500; font-size: 0.9em; color: #495057; margin-bottom: 8px; margin-top: 10px;">ìƒ‰ìƒ</label>
                    <input type="color" id="watermark-stroke-color" value="#000000" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                </div>
            </div>
        </div>

        <div class="section-card">
            <h3>í‘œì • ì´ë¦„</h3>
            <div class="checkbox-group" style="margin-bottom: 16px;">
                <input type="checkbox" id="enable-expression-labels">
                <label for="enable-expression-labels">í‘œì • ì´ë¦„ í‘œì‹œ</label>
            </div>
            <div id="expression-labels-settings" style="display: none;">
                <div class="input-group">
                    <label style="display: block; margin-bottom: 8px;">í‘œì • ì´ë¦„ ì…ë ¥ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                    <textarea id="expression-names" placeholder="ê¸°ë³¸, ì›ƒìŒ, í™”ë‚¨, ìŠ¬í””, ë†€ëŒ" style="width: 100%; height: 80px; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; box-sizing: border-box; font-family: inherit; resize: vertical;"></textarea>
                </div>

                <div class="input-group">
                    <label for="expr-align">í…ìŠ¤íŠ¸ ì •ë ¬</label>
                    <select id="expr-align" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <option value="left">ì™¼ìª½</option>
                        <option value="center" selected>ì¤‘ì•™</option>
                        <option value="right">ì˜¤ë¥¸ìª½</option>
                    </select>
                </div>

                <div class="input-group-linked">
                    <label for="expr-font-size">í¬ê¸°</label>
                    <input type="range" id="expr-font-size-slider" value="12" min="8" max="48">
                    <input type="number" id="expr-font-size" value="12" min="8" max="48">
                </div>

                <div class="input-group">
                    <label for="expr-color">ìƒ‰ìƒ</label>
                    <input type="color" id="expr-color" value="#333333" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                </div>

                <div class="input-group">
                    <label for="expr-font-weight">ê¸€ê¼´ êµµê¸°</label>
                    <select id="expr-font-weight" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <option value="normal">Normal (400)</option>
                        <option value="bold">Bold (700)</option>
                        <option value="100">Thin (100)</option>
                        <option value="300">Light (300)</option>
                        <option value="500" selected>Medium (500)</option>
                        <option value="900">Black (900)</option>
                    </select>
                </div>

                <div class="input-group-linked">
                    <label for="expr-offset-x">X ì˜¤í”„ì…‹</label>
                    <input type="range" id="expr-offset-x-slider" value="0" min="-100" max="100">
                    <input type="number" id="expr-offset-x" value="0" min="-100" max="100">
                </div>

                <div class="input-group-linked">
                    <label for="expr-offset-y">Y ì˜¤í”„ì…‹</label>
                    <input type="range" id="expr-offset-y-slider" value="0" min="-100" max="100">
                    <input type="number" id="expr-offset-y" value="0" min="-100" max="100">
                </div>

                <div class="input-group">
                    <div class="checkbox-group" style="padding: 0; background: none;">
                        <input type="checkbox" id="expr-shadow-enable">
                        <label for="expr-shadow-enable">í…ìŠ¤íŠ¸ ê·¸ë¦¼ì</label>
                    </div>
                    <div id="expr-shadow-options" style="display: none; margin-top: 10px;">
                        <div class="input-group-linked">
                            <label for="expr-shadow-x">X</label>
                            <input type="range" id="expr-shadow-x-slider" value="1" min="-10" max="10">
                            <input type="number" id="expr-shadow-x" value="1" min="-10" max="10">
                        </div>
                        <div class="input-group-linked">
                            <label for="expr-shadow-y">Y</label>
                            <input type="range" id="expr-shadow-y-slider" value="1" min="-10" max="10">
                            <input type="number" id="expr-shadow-y" value="1" min="-10" max="10">
                        </div>
                        <div class="input-group-linked">
                            <label for="expr-shadow-blur">íë¦¼</label>
                            <input type="range" id="expr-shadow-blur-slider" value="2" min="0" max="20">
                            <input type="number" id="expr-shadow-blur" value="2" min="0" max="20">
                        </div>
                        <label for="expr-shadow-color" style="font-weight: 500; font-size: 0.9em; color: #495057; margin-bottom: 8px; margin-top: 10px;">ìƒ‰ìƒ</label>
                        <input type="color" id="expr-shadow-color" value="#FFFFFF" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                    </div>
                </div>

                <div class="input-group">
                    <div class="checkbox-group" style="padding: 0; background: none;">
                        <input type="checkbox" id="expr-stroke-enable">
                        <label for="expr-stroke-enable">í…ìŠ¤íŠ¸ ì™¸ê³½ì„ </label>
                    </div>
                    <div id="expr-stroke-options" style="display: none; margin-top: 10px;">
                        <div class="input-group-linked">
                            <label for="expr-stroke-width">ë‘ê»˜</label>
                            <input type="range" id="expr-stroke-width-slider" value="1" min="1" max="5">
                            <input type="number" id="expr-stroke-width" value="1" min="1" max="5">
                        </div>
                        <label for="expr-stroke-color" style="font-weight: 500; font-size: 0.9em; color: #495057; margin-bottom: 8px; margin-top: 10px;">ìƒ‰ìƒ</label>
                        <input type="color" id="expr-stroke-color" value="#000000" style="width: 100%; height: 40px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer;">
                    </div>
                </div>
            </div>
        </div>

        <div class="section-card">
            <h3>ë¡œê³ /ì´ë¯¸ì§€ ì¶”ê°€</h3>
            <div class="input-group">
                <label for="logo-uploader">ë¡œê³  ì´ë¯¸ì§€</label>
                <input type="file" id="logo-uploader" accept="image/*">
            </div>
            <div class="input-group">
                <button id="clear-logo-btn" class="clear-all-btn" style="background-color: #6c757d; padding: 8px 12px; font-size: 0.85em;">ë¡œê³  ì´ë¯¸ì§€ ì§€ìš°ê¸°</button>
            </div>
            <div class="input-group-linked">
                <label for="logo-x">X</label>
                <input type="range" id="logo-x-slider" value="20" min="0" max="2000">
                <input type="number" id="logo-x" value="20" min="0" max="2000">
            </div>
            <div class="input-group-linked">
                <label for="logo-y">Y</label>
                <input type="range" id="logo-y-slider" value="20" min="0" max="2000">
                <input type="number" id="logo-y" value="20" min="0" max="2000">
            </div>
            <div class="input-group-linked">
                <label for="logo-max-width">ìµœëŒ€ ë„ˆë¹„</label>
                <input type="range" id="logo-max-width-slider" value="150" min="50" max="500">
                <input type="number" id="logo-max-width" value="150" min="50" max="500">
            </div>
        </div>
    </div>

    <script>
        // ==================== í—¬í¼ í•¨ìˆ˜ ====================

        // ìŠ¬ë¼ì´ë”-ìˆ«ì ì…ë ¥ ì—°ë™
        function linkSliderToNumber(numberId, sliderId, callback) {
            const numberInput = document.getElementById(numberId);
            const sliderInput = document.getElementById(sliderId);

            if (!numberInput || !sliderInput) {
                console.warn(`Link Error: ${numberId} or ${sliderId} not found.`);
                return;
            }

            // ìˆ«ì ì…ë ¥ ê²€ì¦ ë° ì ìš© í•¨ìˆ˜
            function validateAndApply() {
                let value = parseFloat(numberInput.value);

                // ë¹ˆ ê°’ì´ê±°ë‚˜ ìˆ«ìê°€ ì•„ë‹ˆë©´ ìµœì†Œê°’ìœ¼ë¡œ ì„¤ì •
                if (isNaN(value) || numberInput.value === '') {
                    value = numberInput.hasAttribute('min') ? parseFloat(numberInput.getAttribute('min')) : 0;
                }

                // ë²”ìœ„ ê²€ì¦
                if (numberInput.hasAttribute('min')) {
                    value = Math.max(value, parseFloat(numberInput.getAttribute('min')));
                }
                if (numberInput.hasAttribute('max')) {
                    value = Math.min(value, parseFloat(numberInput.getAttribute('max')));
                }

                numberInput.value = value;
                sliderInput.value = value;
                if (callback) callback(value);
            }

            // input ì´ë²¤íŠ¸: ì‹¤ì‹œê°„ìœ¼ë¡œ ìŠ¬ë¼ì´ë”ë§Œ ì—…ë°ì´íŠ¸ (ê²€ì¦ ì—†ìŒ)
            numberInput.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                if (!isNaN(value)) {
                    sliderInput.value = value;
                }
            });

            // blur ì´ë²¤íŠ¸: í¬ì»¤ìŠ¤ë¥¼ ìƒì„ ë•Œ ê²€ì¦ ë° ì ìš©
            numberInput.addEventListener('blur', validateAndApply);

            // keydown ì´ë²¤íŠ¸: ì—”í„° í‚¤ë¥¼ ëˆ„ë¥¼ ë•Œ ê²€ì¦ ë° ì ìš©
            numberInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    validateAndApply();
                    numberInput.blur(); // í¬ì»¤ìŠ¤ ì œê±°
                }
            });

            // ìŠ¬ë¼ì´ë” ë³€ê²½ ì‹œ ì¦‰ì‹œ ì ìš©
            sliderInput.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                numberInput.value = value;
                if (callback) callback(value);
            });
        }

        // ==================== DOM ìš”ì†Œ ====================
        const sheetCanvas = document.getElementById('sheet-canvas');
        const bgImageContainer = document.getElementById('bg-image-container');
        const baseImageContainer = document.getElementById('base-image-container');
        const baseImageElement = document.getElementById('base-image');
        const gridContainer = document.getElementById('grid-container');

        // ==================== ì„¤ì •ê°’ ê´€ë¦¬ ====================

        // ê¸°ë³¸ ì„¤ì •ê°’
        const defaultConfig = {
            sheet: { width: 1200, height: 1500 },
            previewScale: 0.6,
            baseImage: { file: null, url: '', x: 100, y: 50, scale: 1.0 },
            faceBox: { x: 150, y: 100, w: 120, h: 150 },
            grid: {
                files: [], urls: [],
                x: 700, y: 50,
                columns: 5, gap: 10,
                itemScale: 1.0,
                roundCorners: false
            },
            decoration: {
                enabled: true,
                globalFont: {
                    fontUrl: '',
                    fontFamily: 'Arial'
                },
                background: {
                    type: 'transparent',
                    color: '#ffffff',
                    colorType: 'color',
                    colorGradientStart: '#ffffff',
                    colorGradientEnd: '#000000',
                    imageUrl: '',
                    baseType: 'color',
                    baseColor: '#ffffff',
                    gradientStart: '#ffffff',
                    gradientEnd: '#000000',
                    imageX: 0,
                    imageY: 0,
                    imageScale: 100,
                    imageOpacity: 100
                },
                characterName: {
                    text: '',
                    useCustomFont: false,
                    fontUrl: '',
                    fontFamily: 'Arial',
                    textAlign: 'left',
                    fontSize: 32,
                    x: 20,
                    y: 20,
                    color: '#333333',

                    fontWeight: 'bold',

                    stroke: {
                        enabled: false,
                        width: 1,
                        color: '#000000'
                    },

                    shadow: {
                        enabled: false,
                        x: 2,
                        y: 2,
                        blur: 4,
                        color: '#FFFFFF'
                    }
                },
                characterDescription: {
                    text: '',
                    useCustomFont: false,
                    fontUrl: '',
                    fontFamily: 'Arial',
                    textAlign: 'left',
                    fontSize: 16,
                    x: 20,
                    y: 60,
                    color: '#666666',
                    fontWeight: 'normal'
                },
                watermark: {
                    text: '',
                    fontUrl: '',
                    fontFamily: 'Arial',
                    fontSize: 16,
                    x: 20,
                    y: 20,
                    color: '#999999',
                    fontWeight: 'normal',

                    shadow: {
                        enabled: false,
                        x: 1,
                        y: 1,
                        blur: 2,
                        color: '#FFFFFF'
                    },

                    stroke: {
                        enabled: false,
                        width: 1,
                        color: '#000000'
                    }
                },
                expressionLabels: {
                    enabled: false,
                    names: [],
                    fontUrl: '',
                    fontFamily: 'Arial',
                    textAlign: 'center',
                    fontSize: 12,
                    color: '#333333',
                    fontWeight: '500',
                    offsetX: 0,
                    offsetY: 0,

                    shadow: {
                        enabled: false,
                        x: 1,
                        y: 1,
                        blur: 2,
                        color: '#FFFFFF'
                    },

                    stroke: {
                        enabled: false,
                        width: 1,
                        color: '#000000'
                    }
                },
                logo: {
                    url: '',
                    x: 20,
                    y: 20,
                    maxWidth: 150
                }
            }
        };

        // í˜„ì¬ ì„¤ì •ê°’
        let sheetConfig = JSON.parse(JSON.stringify(defaultConfig));

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
        function saveSettings() {
            try {
                const configToSave = JSON.parse(JSON.stringify(sheetConfig));
                configToSave.baseImage.url = '';
                configToSave.baseImage.file = null;
                configToSave.grid.files = [];
                configToSave.grid.urls = [];
                configToSave.decoration.background.imageUrl = '';
                configToSave.decoration.logo.url = '';

                localStorage.setItem('characterSheetConfig', JSON.stringify(configToSave));
            } catch (e) {
                console.error('ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', e);
            }
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë³µì›
        function loadSettings() {
            try {
                const saved = localStorage.getItem('characterSheetConfig');
                if (saved) {
                    const loadedConfig = JSON.parse(saved);
                    Object.keys(loadedConfig).forEach(key => {
                        if (key === 'baseImage' || key === 'grid' || key === 'decoration') {
                            sheetConfig[key] = { ...sheetConfig[key], ...loadedConfig[key] };
                            if (key === 'decoration') {
                                Object.keys(loadedConfig[key]).forEach(subKey => {
                                    if (typeof loadedConfig[key][subKey] === 'object') {
                                        sheetConfig[key][subKey] = { ...sheetConfig[key][subKey], ...loadedConfig[key][subKey] };
                                    }
                                });
                            }
                        } else {
                            sheetConfig[key] = loadedConfig[key];
                        }
                    });
                    return true;
                }
            } catch (e) {
                console.error('ì„¤ì • ë³µì› ì‹¤íŒ¨:', e);
            }
            return false;
        }

        // ì„¤ì • ì´ˆê¸°í™”
        function resetSettings() {
            if (confirm('ëª¨ë“  ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                sheetConfig = JSON.parse(JSON.stringify(defaultConfig));
                localStorage.removeItem('characterSheetConfig');
                location.reload();
            }
        }

        // ==================== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ====================

        // ìº”ë²„ìŠ¤ í¬ê¸°ì— ë”°ë¼ ì¥ì‹ ìš”ì†Œë“¤ì˜ ìµœëŒ€ê°’ ì—…ë°ì´íŠ¸
        function updateDecorationMaxValues() {
            const maxWidth = sheetConfig.sheet.width;
            const maxHeight = sheetConfig.sheet.height;

            // ìºë¦­í„° ì´ë¦„ X, Y
            ['name-x', 'name-x-slider'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.max = maxWidth;
                    if (parseFloat(el.value) > maxWidth) el.value = maxWidth;
                }
            });
            ['name-y', 'name-y-slider'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.max = maxHeight;
                    if (parseFloat(el.value) > maxHeight) el.value = maxHeight;
                }
            });

            // ìºë¦­í„° ì„¤ëª… X, Y
            ['desc-x', 'desc-x-slider'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.max = maxWidth;
                    if (parseFloat(el.value) > maxWidth) el.value = maxWidth;
                }
            });
            ['desc-y', 'desc-y-slider'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.max = maxHeight;
                    if (parseFloat(el.value) > maxHeight) el.value = maxHeight;
                }
            });

            // ì›Œí„°ë§ˆí¬ X, Y
            ['watermark-x', 'watermark-x-slider'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.max = maxWidth;
                    if (parseFloat(el.value) > maxWidth) el.value = maxWidth;
                }
            });
            ['watermark-y', 'watermark-y-slider'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.max = maxHeight;
                    if (parseFloat(el.value) > maxHeight) el.value = maxHeight;
                }
            });

            // ë¡œê³  X, Y
            ['logo-x', 'logo-x-slider'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.max = maxWidth;
                    if (parseFloat(el.value) > maxWidth) el.value = maxWidth;
                }
            });
            ['logo-y', 'logo-y-slider'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.max = maxHeight;
                    if (parseFloat(el.value) > maxHeight) el.value = maxHeight;
                }
            });
        }

        // ì‹œíŠ¸ í¬ê¸° ì¡°ì •
        linkSliderToNumber('sheet-width', 'sheet-width-slider', (value) => {
            sheetConfig.sheet.width = value;
            updateDecorationMaxValues();
            constrainGridPosition();
            renderPreview();
        });

        linkSliderToNumber('sheet-height', 'sheet-height-slider', (value) => {
            sheetConfig.sheet.height = value;
            updateDecorationMaxValues();
            constrainGridPosition();
            renderPreview();
        });

        const inputs = document.querySelectorAll('.control-panel input');
        inputs.forEach(input => {
            const excludedIds = [
                'sheet-width', 'sheet-width-slider',
                'sheet-height', 'sheet-height-slider',
                'bg-image-x', 'bg-image-x-slider',
                'bg-image-y', 'bg-image-y-slider',
                'bg-image-scale', 'bg-image-scale-slider',
                'bg-image-opacity', 'bg-image-opacity-slider'
            ];
            if (!excludedIds.includes(input.id)) {
                input.addEventListener('input', updateConfigAndRender);
                input.addEventListener('change', updateConfigAndRender);
            }
        });
        document.getElementById('round-face-boxes').addEventListener('change', (e) => {
            sheetConfig.grid.roundCorners = e.target.checked;
            renderPreview();
        });

        // ê¾¸ë¯¸ê¸° íŒ¨ë„ í† ê¸€
        document.getElementById('enable-decoration').addEventListener('change', (e) => {
            sheetConfig.decoration.enabled = e.target.checked;
            const panel = document.getElementById('decoration-panel');
            if (e.target.checked) {
                panel.classList.remove('inactive');
            } else {
                panel.classList.add('inactive');
            }
        });

        // ë°°ê²½ íƒ€ì… ë³€ê²½
        document.getElementById('bg-type').addEventListener('change', (e) => {
            const type = e.target.value;
            sheetConfig.decoration.background.type = type;

            document.getElementById('bg-color-option').style.display = type === 'color' ? 'block' : 'none';
            document.getElementById('bg-image-option').style.display = type === 'image' ? 'block' : 'none';

            renderPreview();
        });

        // ë°°ê²½ ìƒ‰ìƒ íƒ€ì… ë³€ê²½
        document.getElementById('bg-color-type').addEventListener('change', (e) => {
            sheetConfig.decoration.background.colorType = e.target.value;
            const singleOption = document.getElementById('bg-color-single-option');
            const gradientOption = document.getElementById('bg-color-gradient-option');
            if (e.target.value === 'color') {
                singleOption.style.display = 'block';
                gradientOption.style.display = 'none';
            } else {
                singleOption.style.display = 'none';
                gradientOption.style.display = 'block';
            }
            renderPreview();
        });

        // ë°°ê²½ ìƒ‰ìƒ ë³€ê²½
        document.getElementById('bg-color').addEventListener('input', (e) => {
            sheetConfig.decoration.background.color = e.target.value;
            renderPreview();
        });

        // ë°°ê²½ ìƒ‰ìƒ ê·¸ë¼ë°ì´ì…˜ ë³€ê²½
        document.getElementById('bg-color-gradient-start').addEventListener('input', (e) => {
            sheetConfig.decoration.background.colorGradientStart = e.target.value;
            renderPreview();
        });

        document.getElementById('bg-color-gradient-end').addEventListener('input', (e) => {
            sheetConfig.decoration.background.colorGradientEnd = e.target.value;
            renderPreview();
        });

        // ë°°ê²½ ì´ë¯¸ì§€ ì—…ë¡œë“œ
        document.getElementById('bg-image-uploader').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    sheetConfig.decoration.background.imageUrl = e.target.result;
                    renderPreview();
                };
                reader.readAsDataURL(file);
            }
        });

        // ë°°ê²½ ì´ë¯¸ì§€ ë² ì´ìŠ¤ íƒ€ì… ë³€ê²½
        document.getElementById('bg-image-base-type').addEventListener('change', (e) => {
            sheetConfig.decoration.background.baseType = e.target.value;
            const colorOption = document.getElementById('bg-image-base-color-option');
            const gradientOption = document.getElementById('bg-image-base-gradient-option');
            if (e.target.value === 'color') {
                colorOption.style.display = 'block';
                gradientOption.style.display = 'none';
            } else {
                colorOption.style.display = 'none';
                gradientOption.style.display = 'block';
            }
            renderPreview();
        });

        // ë°°ê²½ ì´ë¯¸ì§€ ë² ì´ìŠ¤ ìƒ‰ìƒ
        document.getElementById('bg-image-base-color').addEventListener('input', (e) => {
            sheetConfig.decoration.background.baseColor = e.target.value;
            renderPreview();
        });

        // ë°°ê²½ ì´ë¯¸ì§€ ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ
        document.getElementById('bg-image-gradient-start').addEventListener('input', (e) => {
            sheetConfig.decoration.background.gradientStart = e.target.value;
            renderPreview();
        });

        document.getElementById('bg-image-gradient-end').addEventListener('input', (e) => {
            sheetConfig.decoration.background.gradientEnd = e.target.value;
            renderPreview();
        });

        // ë°°ê²½ ì´ë¯¸ì§€ ìœ„ì¹˜ ë° í¬ê¸°/íˆ¬ëª…ë„
        linkSliderToNumber('bg-image-x', 'bg-image-x-slider', (value) => {
            sheetConfig.decoration.background.imageX = value;
            renderPreview();
        });

        linkSliderToNumber('bg-image-y', 'bg-image-y-slider', (value) => {
            sheetConfig.decoration.background.imageY = value;
            renderPreview();
        });

        linkSliderToNumber('bg-image-scale', 'bg-image-scale-slider', (value) => {
            sheetConfig.decoration.background.imageScale = value;
            renderPreview();
        });

        linkSliderToNumber('bg-image-opacity', 'bg-image-opacity-slider', (value) => {
            sheetConfig.decoration.background.imageOpacity = value;
            renderPreview();
        });

        // ==================== í°íŠ¸ ê´€ë¦¬ ====================

        // í°íŠ¸ ë°ì´í„° ë§¤í•‘
        const fonts = {
            'Montserrat': 'https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap',
            'Lato': 'https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap',
            'Raleway': 'https://fonts.googleapis.com/css2?family=Raleway:wght@400;700;900&display=swap',
            'Oswald': 'https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap',
            'Merriweather': 'https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&display=swap',
            'Noto Sans KR': 'https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap',
            'Pretendard': 'https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css',
            'Spoqa Han Sans Neo': 'https://cdn.jsdelivr.net/gh/spoqa/spoqa-han-sans@latest/css/SpoqaHanSansNeo.css',
            'GmarketSans': 'https://cdn.jsdelivr.net/gh/fonts-archive/GmarketSans/GmarketSans.css',
            'IBM Plex Sans KR': 'https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@400;700&display=swap',
            'Nanum Gothic': 'https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap',
            'Nanum Myeongjo': 'https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap',
            'Black Han Sans': 'https://fonts.googleapis.com/css2?family=Black+Han+Sans&display=swap',
            'Jua': 'https://fonts.googleapis.com/css2?family=Jua&display=swap',
            'Do Hyeon': 'https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap',
            'Gamja Flower': 'https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap',
            'Gowun Dodum': 'https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap',
            'Noto Sans JP': 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap',
            'Noto Serif JP': 'https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700;900&display=swap',
            'M PLUS 1p': 'https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@400;700;900&display=swap',
            'Sawarabi Gothic': 'https://fonts.googleapis.com/css2?family=Sawarabi+Gothic&display=swap',
            'Kosugi Maru': 'https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap',
            'Noto Sans SC': 'https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap',
            'Noto Sans TC': 'https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap',
            'Noto Serif SC': 'https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700;900&display=swap',
            'Noto Serif TC': 'https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap',
            'Ma Shan Zheng': 'https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap'
        };

        // í°íŠ¸ ì˜µì…˜ ë°ì´í„°
        const fontOptions = [
            {
                label: 'English',
                fonts: [
                    { value: 'Montserrat', label: 'Montserrat (ëª¬ì„¸ë¼íŠ¸)' },
                    { value: 'Lato', label: 'Lato (ë¼í† )' },
                    { value: 'Raleway', label: 'Raleway (ë ë¦¬ì›¨ì´)' },
                    { value: 'Oswald', label: 'Oswald (ì˜¤ìŠ¤ì™ˆë“œ)' },
                    { value: 'Merriweather', label: 'Merriweather (ë©”ë¦¬ì›¨ë”)' }
                ]
            },
            {
                label: 'í•œêµ­ì–´',
                fonts: [
                    { value: 'Noto Sans KR', label: 'Noto Sans KR (ë³¸ê³ ë”•)' },
                    { value: 'Pretendard', label: 'Pretendard (í”„ë¦¬í…ë‹¤ë“œ)' },
                    { value: 'Spoqa Han Sans Neo', label: 'Spoqa Han Sans Neo (ìŠ¤í¬ì¹´ í•œ ì‚°ìŠ¤)' },
                    { value: 'GmarketSans', label: 'Gmarket Sans (ì§€ë§ˆì¼“ ì‚°ìŠ¤)' },
                    { value: 'IBM Plex Sans KR', label: 'IBM Plex Sans KR' },
                    { value: 'Nanum Gothic', label: 'Nanum Gothic (ë‚˜ëˆ”ê³ ë”•)' },
                    { value: 'Nanum Myeongjo', label: 'Nanum Myeongjo (ë‚˜ëˆ”ëª…ì¡°)' },
                    { value: 'Black Han Sans', label: 'Black Han Sans (í•œì‚°ì²´)' },
                    { value: 'Jua', label: 'Jua (ì£¼ì•„ì²´)' },
                    { value: 'Do Hyeon', label: 'Do Hyeon (ë„í˜„ì²´)' },
                    { value: 'Gamja Flower', label: 'Gamja Flower (ê°ìê½ƒì²´)' },
                    { value: 'Gowun Dodum', label: 'Gowun Dodum (ê³ ìš´ë‹ì›€)' }
                ]
            },
            {
                label: 'æ—¥æœ¬èª',
                fonts: [
                    { value: 'Noto Sans JP', label: 'Noto Sans JP (ë³¸ê³ ë”• JP)' },
                    { value: 'Noto Serif JP', label: 'Noto Serif JP (ë³¸ëª…ì¡° JP)' },
                    { value: 'M PLUS 1p', label: 'M PLUS 1p' },
                    { value: 'Sawarabi Gothic', label: 'Sawarabi Gothic (ì‚¬ì™€ë¼ë¹„ ê³ ë”•)' },
                    { value: 'Kosugi Maru', label: 'Kosugi Maru (ì½”ìŠ¤ê¸° ë§ˆë£¨)' }
                ]
            },
            {
                label: 'ä¸­æ–‡',
                fonts: [
                    { value: 'Noto Sans SC', label: 'Noto Sans SC (ë³¸ê³ ë”• ê°„ì²´)' },
                    { value: 'Noto Sans TC', label: 'Noto Sans TC (ë³¸ê³ ë”• ë²ˆì²´)' },
                    { value: 'Noto Serif SC', label: 'Noto Serif SC (ë³¸ëª…ì¡° ê°„ì²´)' },
                    { value: 'Noto Serif TC', label: 'Noto Serif TC (ë³¸ëª…ì¡° ë²ˆì²´)' },
                    { value: 'Ma Shan Zheng', label: 'Ma Shan Zheng (ë§ˆì‚°ì •)' }
                ]
            }
        ];

        // í°íŠ¸ ì˜µì…˜ ìƒì„± í•¨ìˆ˜
        function populateFontOptions(selectElement) {
            selectElement.innerHTML = '';
            fontOptions.forEach(group => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = group.label;
                group.fonts.forEach(font => {
                    const option = document.createElement('option');
                    option.value = font.value;
                    option.textContent = font.label;
                    optgroup.appendChild(option);
                });
                selectElement.appendChild(optgroup);
            });
        }

        // --- í°íŠ¸ ë¡œë“œ í•¨ìˆ˜ ---
        function loadFont(url) {
            // ê¸°ì¡´ í°íŠ¸ ë§í¬ ì œê±°
            const existingFontLink = document.getElementById('custom-font-link');
            if (existingFontLink) {
                existingFontLink.remove();
            }

            if (url) {
                const link = document.createElement('link');
                link.id = 'custom-font-link';
                link.rel = 'stylesheet';
                link.href = url;
                document.head.appendChild(link);
            }
        }

        // --- í‘œì • ì´ë¦„ í°íŠ¸ ë¡œë“œ í•¨ìˆ˜ ---
        function loadExprFont(url) {
            // ê¸°ì¡´ í‘œì • í°íŠ¸ ë§í¬ ì œê±°
            const existingFontLink = document.getElementById('expr-font-link');
            if (existingFontLink) {
                existingFontLink.remove();
            }

            if (url) {
                const link = document.createElement('link');
                link.id = 'expr-font-link';
                link.rel = 'stylesheet';
                link.href = url;
                document.head.appendChild(link);
            }
        }

        // --- ì›Œí„°ë§ˆí¬ í°íŠ¸ ë¡œë“œ í•¨ìˆ˜ ---
        function loadWatermarkFont(url) {
            // ê¸°ì¡´ ì›Œí„°ë§ˆí¬ í°íŠ¸ ë§í¬ ì œê±°
            const existingFontLink = document.getElementById('watermark-font-link');
            if (existingFontLink) {
                existingFontLink.remove();
            }

            if (url) {
                const link = document.createElement('link');
                link.id = 'watermark-font-link';
                link.rel = 'stylesheet';
                link.href = url;
                document.head.appendChild(link);
            }
        }

        // --- ì „ì—­ í°íŠ¸ ë¡œë“œ í•¨ìˆ˜ ---
        function loadGlobalFont(url) {
            // ê¸°ì¡´ ì „ì—­ í°íŠ¸ ë§í¬ ì œê±°
            const existingFontLink = document.getElementById('global-font-link');
            if (existingFontLink) {
                existingFontLink.remove();
            }

            if (url) {
                const link = document.createElement('link');
                link.id = 'global-font-link';
                link.rel = 'stylesheet';
                link.href = url;
                document.head.appendChild(link);
            }
        }

        // --- ì „ì—­ í°íŠ¸ ì†ŒìŠ¤ ì„ íƒ ---
        document.getElementById('global-font-source').addEventListener('change', (e) => {
            const source = e.target.value;
            document.getElementById('global-font-select').style.display = 'none';
            document.getElementById('global-custom-font-input').style.display = 'none';

            if (source === 'select') {
                document.getElementById('global-font-select').style.display = 'block';
                const fontName = document.getElementById('global-font-list').value;
                if (fonts[fontName]) {
                    loadGlobalFont(fonts[fontName]);
                    sheetConfig.decoration.globalFont.fontFamily = fontName;
                }
            } else if (source === 'custom') {
                document.getElementById('global-custom-font-input').style.display = 'block';
            }
            renderPreview();
        });

        // --- ì „ì—­ í°íŠ¸ ì„ íƒ ---
        document.getElementById('global-font-list').addEventListener('change', (e) => {
            const fontName = e.target.value;
            if (fonts[fontName]) {
                loadGlobalFont(fonts[fontName]);
                sheetConfig.decoration.globalFont.fontFamily = fontName;
                renderPreview();
            }
        });

        // --- ì „ì—­ í°íŠ¸ ì§ì ‘ ì…ë ¥ ---
        document.getElementById('global-font-url').addEventListener('input', (e) => {
            const url = e.target.value.trim();
            sheetConfig.decoration.globalFont.fontUrl = url;
            loadGlobalFont(url);
            renderPreview();
        });

        document.getElementById('global-font-family').addEventListener('input', (e) => {
            sheetConfig.decoration.globalFont.fontFamily = e.target.value || 'Arial';
            renderPreview();
        });

        // --- ìºë¦­í„° ì´ë¦„ ê´€ë ¨ ì…ë ¥ ---
        document.getElementById('character-name').addEventListener('input', (e) => {
            sheetConfig.decoration.characterName.text = e.target.value;
            renderPreview();
        });

        // ìºë¦­í„° ì´ë¦„ ê°œë³„ í°íŠ¸ í† ê¸€
        document.getElementById('name-custom-font').addEventListener('change', (e) => {
            sheetConfig.decoration.characterName.useCustomFont = e.target.checked;
            document.getElementById('name-font-settings').style.display = e.target.checked ? 'block' : 'none';
            renderPreview();
        });

        // ìºë¦­í„° ì´ë¦„ í°íŠ¸ ì†ŒìŠ¤ ì„ íƒ
        document.getElementById('name-font-source').addEventListener('change', (e) => {
            const source = e.target.value;
            document.getElementById('name-font-select').style.display = source === 'select' ? 'block' : 'none';
            document.getElementById('name-custom-font-input').style.display = source === 'custom' ? 'block' : 'none';
            if (source === 'select') {
                const fontName = document.getElementById('name-font-list').value;
                if (fonts[fontName]) {
                    loadFont(fonts[fontName]);
                    sheetConfig.decoration.characterName.fontFamily = fontName;
                }
            }
            renderPreview();
        });

        document.getElementById('name-font-list').addEventListener('change', (e) => {
            const fontName = e.target.value;
            if (fonts[fontName]) {
                loadFont(fonts[fontName]);
                sheetConfig.decoration.characterName.fontFamily = fontName;
                renderPreview();
            }
        });

        const nameFontUrlInput = document.getElementById('name-font-url');
        if (nameFontUrlInput) {
            nameFontUrlInput.addEventListener('input', (e) => {
                const url = e.target.value.trim();
                sheetConfig.decoration.characterName.fontUrl = url;
                loadFont(url);
                renderPreview();
            });
        }

        const nameFontFamilyInput = document.getElementById('name-font-family');
        if (nameFontFamilyInput) {
            nameFontFamilyInput.addEventListener('input', (e) => {
                sheetConfig.decoration.characterName.fontFamily = e.target.value || 'Arial';
                renderPreview();
            });
        }

        document.getElementById('name-align').addEventListener('change', (e) => {
            sheetConfig.decoration.characterName.textAlign = e.target.value;
            renderPreview();
        });

        // --- ìºë¦­í„° ì„¤ëª… ê´€ë ¨ ì…ë ¥ ---
        document.getElementById('character-description').addEventListener('input', (e) => {
            sheetConfig.decoration.characterDescription.text = e.target.value;
            renderPreview();
        });

        // ìºë¦­í„° ì„¤ëª… ê°œë³„ í°íŠ¸ í† ê¸€
        document.getElementById('desc-custom-font').addEventListener('change', (e) => {
            sheetConfig.decoration.characterDescription.useCustomFont = e.target.checked;
            document.getElementById('desc-font-settings').style.display = e.target.checked ? 'block' : 'none';
            renderPreview();
        });

        // ìºë¦­í„° ì„¤ëª… í°íŠ¸ ê´€ë ¨
        document.getElementById('desc-font-source').addEventListener('change', (e) => {
            const source = e.target.value;
            document.getElementById('desc-font-select').style.display = source === 'select' ? 'block' : 'none';
            document.getElementById('desc-custom-font-input').style.display = source === 'custom' ? 'block' : 'none';
            renderPreview();
        });

        document.getElementById('desc-font-list').addEventListener('change', (e) => {
            const fontName = e.target.value;
            if (fonts[fontName]) {
                loadExprFont(fonts[fontName]);
                sheetConfig.decoration.characterDescription.fontFamily = fontName;
                renderPreview();
            }
        });

        document.getElementById('desc-font-url').addEventListener('input', (e) => {
            sheetConfig.decoration.characterDescription.fontUrl = e.target.value.trim();
            loadExprFont(e.target.value.trim());
            renderPreview();
        });

        document.getElementById('desc-font-family-input').addEventListener('input', (e) => {
            sheetConfig.decoration.characterDescription.fontFamily = e.target.value || 'Arial';
            renderPreview();
        });

        document.getElementById('desc-align').addEventListener('change', (e) => {
            sheetConfig.decoration.characterDescription.textAlign = e.target.value;
            renderPreview();
        });

        linkSliderToNumber('desc-font-size', 'desc-font-size-slider', (value) => {
            sheetConfig.decoration.characterDescription.fontSize = value;
            renderPreview();
        });

        linkSliderToNumber('desc-x', 'desc-x-slider', (value) => {
            sheetConfig.decoration.characterDescription.x = value;
            renderPreview();
        });

        linkSliderToNumber('desc-y', 'desc-y-slider', (value) => {
            sheetConfig.decoration.characterDescription.y = value;
            renderPreview();
        });

        document.getElementById('desc-color').addEventListener('input', (e) => {
            sheetConfig.decoration.characterDescription.color = e.target.value;
            renderPreview();
        });

        document.getElementById('desc-font-weight').addEventListener('change', (e) => {
            sheetConfig.decoration.characterDescription.fontWeight = e.target.value;
            renderPreview();
        });

        // (v8) linkSliderToNumber í—¬í¼ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
        linkSliderToNumber('name-font-size', 'name-font-size-slider', (value) => {
            sheetConfig.decoration.characterName.fontSize = value;
            renderPreview();
        });
        
        linkSliderToNumber('name-x', 'name-x-slider', (value) => {
            sheetConfig.decoration.characterName.x = value;
            renderPreview();
        });

        linkSliderToNumber('name-y', 'name-y-slider', (value) => {
            sheetConfig.decoration.characterName.y = value;
            renderPreview();
        });

        document.getElementById('name-color').addEventListener('input', (e) => {
            sheetConfig.decoration.characterName.color = e.target.value;
            renderPreview();
        });

        // --- [ì‹œì‘] ìºë¦­í„° ì´ë¦„ ê¾¸ë¯¸ê¸° ë¦¬ìŠ¤ë„ˆ (v8 ì¶”ê°€) ---

        // í°íŠ¸ êµµê¸°
        document.getElementById('name-font-weight').addEventListener('change', (e) => {
            sheetConfig.decoration.characterName.fontWeight = e.target.value;
            renderPreview();
        });

        // ê·¸ë¼ë°ì´ì…˜ í† ê¸€

        // ì™¸ê³½ì„  í† ê¸€
        document.getElementById('name-stroke-enable').addEventListener('change', (e) => {
            const enabled = e.target.checked;
            sheetConfig.decoration.characterName.stroke.enabled = enabled;
            document.getElementById('name-stroke-options').style.display = enabled ? 'block' : 'none';
            renderPreview();
        });
        // ì™¸ê³½ì„  ë„ˆë¹„ (ìŠ¬ë¼ì´ë” + ìˆ«ì)
        linkSliderToNumber('name-stroke-width', 'name-stroke-width-slider', (value) => {
            sheetConfig.decoration.characterName.stroke.width = value;
            renderPreview();
        });
        // ì™¸ê³½ì„  ìƒ‰ìƒ
        document.getElementById('name-stroke-color').addEventListener('input', (e) => {
            sheetConfig.decoration.characterName.stroke.color = e.target.value;
            renderPreview();
        });

        // ê·¸ë¦¼ì í† ê¸€
        document.getElementById('name-shadow-enable').addEventListener('change', (e) => {
            const enabled = e.target.checked;
            sheetConfig.decoration.characterName.shadow.enabled = enabled;
            document.getElementById('name-shadow-options').style.display = enabled ? 'block' : 'none';
            renderPreview();
        });
        // ê·¸ë¦¼ì X (ìŠ¬ë¼ì´ë” + ìˆ«ì)
        linkSliderToNumber('name-shadow-x', 'name-shadow-x-slider', (value) => {
            sheetConfig.decoration.characterName.shadow.x = value;
            renderPreview();
        });
        // ê·¸ë¦¼ì Y (ìŠ¬ë¼ì´ë” + ìˆ«ì)
        linkSliderToNumber('name-shadow-y', 'name-shadow-y-slider', (value) => {
            sheetConfig.decoration.characterName.shadow.y = value;
            renderPreview();
        });
        // ê·¸ë¦¼ì íë¦¼ (ìŠ¬ë¼ì´ë” + ìˆ«ì)
        linkSliderToNumber('name-shadow-blur', 'name-shadow-blur-slider', (value) => {
            sheetConfig.decoration.characterName.shadow.blur = value;
            renderPreview();
        });
        // ê·¸ë¦¼ì ìƒ‰ìƒ
        document.getElementById('name-shadow-color').addEventListener('input', (e) => {
            sheetConfig.decoration.characterName.shadow.color = e.target.value;
            renderPreview();
        });

        // --- [ë] ìºë¦­í„° ì´ë¦„ ê¾¸ë¯¸ê¸° ë¦¬ìŠ¤ë„ˆ ---


        // --- ì›Œí„°ë§ˆí¬ ì…ë ¥ ---
        document.getElementById('watermark-text').addEventListener('input', (e) => {
            sheetConfig.decoration.watermark.text = e.target.value;
            renderPreview();
        });

        // --- ì›Œí„°ë§ˆí¬ ìŠ¤íƒ€ì¼ ---
        linkSliderToNumber('watermark-font-size', 'watermark-font-size-slider', (value) => {
            sheetConfig.decoration.watermark.fontSize = value;
            renderPreview();
        });

        linkSliderToNumber('watermark-x', 'watermark-x-slider', (value) => {
            sheetConfig.decoration.watermark.x = value;
            renderPreview();
        });

        linkSliderToNumber('watermark-y', 'watermark-y-slider', (value) => {
            sheetConfig.decoration.watermark.y = value;
            renderPreview();
        });

        document.getElementById('watermark-color').addEventListener('input', (e) => {
            sheetConfig.decoration.watermark.color = e.target.value;
            renderPreview();
        });

        document.getElementById('watermark-font-weight').addEventListener('change', (e) => {
            sheetConfig.decoration.watermark.fontWeight = e.target.value;
            renderPreview();
        });

        // --- ì›Œí„°ë§ˆí¬ ê·¸ë¦¼ì ---
        document.getElementById('watermark-shadow-enable').addEventListener('change', (e) => {
            const enabled = e.target.checked;
            sheetConfig.decoration.watermark.shadow.enabled = enabled;
            document.getElementById('watermark-shadow-options').style.display = enabled ? 'block' : 'none';
            renderPreview();
        });

        linkSliderToNumber('watermark-shadow-x', 'watermark-shadow-x-slider', (value) => {
            sheetConfig.decoration.watermark.shadow.x = value;
            renderPreview();
        });

        linkSliderToNumber('watermark-shadow-y', 'watermark-shadow-y-slider', (value) => {
            sheetConfig.decoration.watermark.shadow.y = value;
            renderPreview();
        });

        linkSliderToNumber('watermark-shadow-blur', 'watermark-shadow-blur-slider', (value) => {
            sheetConfig.decoration.watermark.shadow.blur = value;
            renderPreview();
        });

        document.getElementById('watermark-shadow-color').addEventListener('input', (e) => {
            sheetConfig.decoration.watermark.shadow.color = e.target.value;
            renderPreview();
        });


        // --- ì›Œí„°ë§ˆí¬ ì™¸ê³½ì„  ---
        document.getElementById('watermark-stroke-enable').addEventListener('change', (e) => {
            const enabled = e.target.checked;
            sheetConfig.decoration.watermark.stroke.enabled = enabled;
            document.getElementById('watermark-stroke-options').style.display = enabled ? 'block' : 'none';
            renderPreview();
        });

        linkSliderToNumber('watermark-stroke-width', 'watermark-stroke-width-slider', (value) => {
            sheetConfig.decoration.watermark.stroke.width = value;
            renderPreview();
        });

        document.getElementById('watermark-stroke-color').addEventListener('input', (e) => {
            sheetConfig.decoration.watermark.stroke.color = e.target.value;
            renderPreview();
        });

        // --- í‘œì • ì´ë¦„ í‘œì‹œ ì²´í¬ë°•ìŠ¤ ---
        document.getElementById('enable-expression-labels').addEventListener('change', (e) => {
            sheetConfig.decoration.expressionLabels.enabled = e.target.checked;
            document.getElementById('expression-labels-settings').style.display = e.target.checked ? 'block' : 'none';
            renderPreview();
        });

        // --- í‘œì • ì´ë¦„ ì…ë ¥ ---
        document.getElementById('expression-names').addEventListener('input', (e) => {
            const names = e.target.value.split(',').map(name => name.trim()).filter(name => name);
            sheetConfig.decoration.expressionLabels.names = names;
            renderPreview();
        });

        // --- í‘œì • ì´ë¦„ ìŠ¤íƒ€ì¼ ---
        document.getElementById('expr-align').addEventListener('change', (e) => {
            sheetConfig.decoration.expressionLabels.textAlign = e.target.value;
            renderPreview();
        });

        linkSliderToNumber('expr-font-size', 'expr-font-size-slider', (value) => {
            sheetConfig.decoration.expressionLabels.fontSize = value;
            renderPreview();
        });

        document.getElementById('expr-color').addEventListener('input', (e) => {
            sheetConfig.decoration.expressionLabels.color = e.target.value;
            renderPreview();
        });

        document.getElementById('expr-font-weight').addEventListener('change', (e) => {
            sheetConfig.decoration.expressionLabels.fontWeight = e.target.value;
            renderPreview();
        });

        // --- í‘œì • ì´ë¦„ ìœ„ì¹˜ ì˜¤í”„ì…‹ ---
        linkSliderToNumber('expr-offset-x', 'expr-offset-x-slider', (value) => {
            sheetConfig.decoration.expressionLabels.offsetX = value;
            renderPreview();
        });

        linkSliderToNumber('expr-offset-y', 'expr-offset-y-slider', (value) => {
            sheetConfig.decoration.expressionLabels.offsetY = value;
            renderPreview();
        });

        // --- í‘œì • ì´ë¦„ ê·¸ë¦¼ì ---
        document.getElementById('expr-shadow-enable').addEventListener('change', (e) => {
            const enabled = e.target.checked;
            sheetConfig.decoration.expressionLabels.shadow.enabled = enabled;
            document.getElementById('expr-shadow-options').style.display = enabled ? 'block' : 'none';
            renderPreview();
        });

        linkSliderToNumber('expr-shadow-x', 'expr-shadow-x-slider', (value) => {
            sheetConfig.decoration.expressionLabels.shadow.x = value;
            renderPreview();
        });

        linkSliderToNumber('expr-shadow-y', 'expr-shadow-y-slider', (value) => {
            sheetConfig.decoration.expressionLabels.shadow.y = value;
            renderPreview();
        });

        linkSliderToNumber('expr-shadow-blur', 'expr-shadow-blur-slider', (value) => {
            sheetConfig.decoration.expressionLabels.shadow.blur = value;
            renderPreview();
        });

        document.getElementById('expr-shadow-color').addEventListener('input', (e) => {
            sheetConfig.decoration.expressionLabels.shadow.color = e.target.value;
            renderPreview();
        });


        // --- í‘œì • ì´ë¦„ ì™¸ê³½ì„  ---
        document.getElementById('expr-stroke-enable').addEventListener('change', (e) => {
            const enabled = e.target.checked;
            sheetConfig.decoration.expressionLabels.stroke.enabled = enabled;
            document.getElementById('expr-stroke-options').style.display = enabled ? 'block' : 'none';
            renderPreview();
        });

        linkSliderToNumber('expr-stroke-width', 'expr-stroke-width-slider', (value) => {
            sheetConfig.decoration.expressionLabels.stroke.width = value;
            renderPreview();
        });

        document.getElementById('expr-stroke-color').addEventListener('input', (e) => {
            sheetConfig.decoration.expressionLabels.stroke.color = e.target.value;
            renderPreview();
        });

        // --- ë¡œê³  ì—…ë¡œë“œ ---
        document.getElementById('logo-uploader').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    sheetConfig.decoration.logo.url = e.target.result;
                    renderPreview();
                };
                reader.readAsDataURL(file);
            }
        });

        // --- ë¡œê³  ìœ„ì¹˜ ë° í¬ê¸° ì¡°ì • ---
        linkSliderToNumber('logo-x', 'logo-x-slider', (value) => {
            sheetConfig.decoration.logo.x = value;
            renderPreview();
        });

        linkSliderToNumber('logo-y', 'logo-y-slider', (value) => {
            sheetConfig.decoration.logo.y = value;
            renderPreview();
        });

        linkSliderToNumber('logo-max-width', 'logo-max-width-slider', (value) => {
            sheetConfig.decoration.logo.maxWidth = value;
            renderPreview();
        });


        function constrainGridPosition() {
            // í‘œì •ì‹œíŠ¸ê°€ ì‹œíŠ¸ ì˜ì—­ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ ì œì•½
            if (sheetConfig.grid.urls.length === 0) return;

            const gridWidth = sheetConfig.grid.columns * sheetConfig.faceBox.w +
                             (sheetConfig.grid.columns - 1) * sheetConfig.grid.gap;
            const gridHeight = Math.ceil(sheetConfig.grid.urls.length / sheetConfig.grid.columns) * sheetConfig.faceBox.h +
                              (Math.ceil(sheetConfig.grid.urls.length / sheetConfig.grid.columns) - 1) * sheetConfig.grid.gap;

            sheetConfig.grid.x = Math.max(0, Math.min(sheetConfig.grid.x, sheetConfig.sheet.width - gridWidth));
            sheetConfig.grid.y = Math.max(0, Math.min(sheetConfig.grid.y, sheetConfig.sheet.height - gridHeight));

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('grid-x').value = sheetConfig.grid.x.toFixed(0);
            document.getElementById('grid-y').value = sheetConfig.grid.y.toFixed(0);
            document.getElementById('grid-x-slider').value = sheetConfig.grid.x.toFixed(0);
            document.getElementById('grid-y-slider').value = sheetConfig.grid.y.toFixed(0);
        }

        function updateConfigAndRender(event) {
            const input = event.target;
            const id = input.id;
            const isSlider = input.type === 'range' || id.endsWith('-slider');
            let baseId = id.replace('-slider', '');

            let value = (input.type === 'number' || input.type === 'range') ? parseFloat(input.value) : input.value;

            switch (baseId) {
                case 'sheet-width': sheetConfig.sheet.width = value; break;
                case 'sheet-height': sheetConfig.sheet.height = value; break;
                case 'preview-scale': sheetConfig.previewScale = value / 100; break;

                case 'base-image-x': sheetConfig.baseImage.x = value; break;
                case 'base-image-y': sheetConfig.baseImage.y = value; break;
                case 'base-image-scale': sheetConfig.baseImage.scale = value / 100; break;

                case 'face-x': sheetConfig.faceBox.x = value; break;
                case 'face-y': sheetConfig.faceBox.y = value; break;
                case 'face-w': sheetConfig.faceBox.w = value; break;
                case 'face-h': sheetConfig.faceBox.h = value; break;

                case 'grid-x': sheetConfig.grid.x = value; break;
                case 'grid-y': sheetConfig.grid.y = value; break;
                case 'grid-columns': sheetConfig.grid.columns = Math.max(1, Math.round(value)); break;
                case 'grid-gap': sheetConfig.grid.gap = value; break;
                case 'grid-item-scale': sheetConfig.grid.itemScale = value / 100; break;
            }

            if (id.startsWith('sheet-') || id.startsWith('preview-') || id.startsWith('base-') || id.startsWith('face-') || id.startsWith('grid-')) {
                const numberInput = document.getElementById(baseId);
                const sliderInput = document.getElementById(baseId + '-slider');

                if (numberInput && sliderInput) {
                    if (isSlider) {
                        numberInput.value = value;
                    } else {
                        sliderInput.value = value;
                    }
                }
            }

            if (input.type !== 'file') {
                constrainGridPosition();
                renderPreview();
            }
        }

        // --- 2. íŒŒì¼ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬ ---
        
        document.getElementById('base-image-uploader').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                sheetConfig.baseImage.file = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    sheetConfig.baseImage.url = e.target.result;
                    renderPreview();
                };
                reader.readAsDataURL(file);
            }
        });

        // ì¸ë„¤ì¼ ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜
        function renderImagePreviews() {
            const container = document.getElementById('image-preview-list');
            container.innerHTML = '';

            sheetConfig.grid.urls.forEach((url, index) => {
                const item = document.createElement('div');
                item.className = 'image-preview-item';

                const img = document.createElement('img');
                img.src = url;

                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = 'Ã—';
                removeBtn.onclick = () => removeImage(index);

                // í™”ì‚´í‘œ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ
                const arrowButtons = document.createElement('div');
                arrowButtons.className = 'arrow-buttons';

                // ì™¼ìª½ í™”ì‚´í‘œ ë²„íŠ¼
                const leftBtn = document.createElement('button');
                leftBtn.className = 'arrow-btn';
                leftBtn.innerHTML = 'â†';
                leftBtn.onclick = () => moveImage(index, -1);
                if (index === 0) leftBtn.disabled = true;

                // ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ ë²„íŠ¼
                const rightBtn = document.createElement('button');
                rightBtn.className = 'arrow-btn';
                rightBtn.innerHTML = 'â†’';
                rightBtn.onclick = () => moveImage(index, 1);
                if (index === sheetConfig.grid.urls.length - 1) rightBtn.disabled = true;

                arrowButtons.appendChild(leftBtn);
                arrowButtons.appendChild(rightBtn);

                item.appendChild(img);
                item.appendChild(removeBtn);
                item.appendChild(arrowButtons);
                container.appendChild(item);
            });
        }

        // ì´ë¯¸ì§€ ìˆœì„œ ë³€ê²½ í•¨ìˆ˜
        function moveImage(index, direction) {
            const newIndex = index + direction;

            // ë²”ìœ„ ì²´í¬
            if (newIndex < 0 || newIndex >= sheetConfig.grid.urls.length) {
                return;
            }

            // files ë°°ì—´ì—ì„œ ìˆœì„œ ë³€ê²½
            const tempFile = sheetConfig.grid.files[index];
            sheetConfig.grid.files[index] = sheetConfig.grid.files[newIndex];
            sheetConfig.grid.files[newIndex] = tempFile;

            // urls ë°°ì—´ì—ì„œ ìˆœì„œ ë³€ê²½
            const tempUrl = sheetConfig.grid.urls[index];
            sheetConfig.grid.urls[index] = sheetConfig.grid.urls[newIndex];
            sheetConfig.grid.urls[newIndex] = tempUrl;

            renderImagePreviews();
            renderPreview();
        }

        // ê°œë³„ ì´ë¯¸ì§€ ì‚­ì œ í•¨ìˆ˜
        function removeImage(index) {
            sheetConfig.grid.files.splice(index, 1);
            sheetConfig.grid.urls.splice(index, 1);
            renderImagePreviews();
            constrainGridPosition();
            renderPreview();
        }

        // ì „ì²´ ì´ë¯¸ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
        function clearAllImages() {
            // í™•ì¸ ë©”ì‹œì§€
            if (confirm('ëª¨ë“  ì´ë¯¸ì§€(ì „ì‹  + í‘œì •)ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ì „ì‹  ì´ë¯¸ì§€ ì´ˆê¸°í™”
                sheetConfig.baseImage.file = null;
                sheetConfig.baseImage.url = '';
                document.getElementById('base-image-uploader').value = '';

                // í‘œì • ì´ë¯¸ì§€ ì´ˆê¸°í™”
                sheetConfig.grid.files = [];
                sheetConfig.grid.urls = [];
                document.getElementById('face-grid-uploader').value = '';

                renderImagePreviews();
                renderPreview();
            }
        }

        // ì „ì²´ ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('clear-all-images-btn').addEventListener('click', clearAllImages);

        // ë°°ê²½ ì´ë¯¸ì§€ ì§€ìš°ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('clear-bg-image-btn').addEventListener('click', () => {
            sheetConfig.decoration.background.imageUrl = '';
            document.getElementById('bg-image-uploader').value = '';
            renderPreview();
        });

        // ë¡œê³  ì´ë¯¸ì§€ ì§€ìš°ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('clear-logo-btn').addEventListener('click', () => {
            sheetConfig.decoration.logo.url = '';
            document.getElementById('logo-uploader').value = '';
            renderPreview();
        });

        document.getElementById('face-grid-uploader').addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                // ê¸°ì¡´ íŒŒì¼ì— ì¶”ê°€
                sheetConfig.grid.files.push(...files);

                let loadedCount = 0;
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        sheetConfig.grid.urls.push(e.target.result);
                        loadedCount++;
                        if (loadedCount === files.length) {
                            renderImagePreviews();
                            constrainGridPosition();
                            renderPreview();
                        }
                    };
                    reader.readAsDataURL(file);
                });
            }
            // íŒŒì¼ ì„ íƒ í›„ input ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡)
            e.target.value = '';
        });

        // --- 3. í”„ë¦¬ë·° ë Œë”ë§ í•¨ìˆ˜ ---
        
        function renderPreview() {
            // 1. ì‹œíŠ¸ í¬ê¸° ë° ë¯¸ë¦¬ë³´ê¸° ìŠ¤ì¼€ì¼
            sheetCanvas.style.width = `${sheetConfig.sheet.width}px`;
            sheetCanvas.style.height = `${sheetConfig.sheet.height}px`;
            sheetCanvas.style.maxWidth = 'none'; // max-width ì œí•œ ì œê±°
            sheetCanvas.style.minWidth = 'auto'; // ìµœì†Œ ë„ˆë¹„ ìë™
            sheetCanvas.style.transform = `scale(${sheetConfig.previewScale})`;

            // ë°°ê²½ ì„¤ì •
            if (sheetConfig.decoration.enabled) {
                const bgType = sheetConfig.decoration.background.type;
                if (bgType === 'transparent') {
                    sheetCanvas.style.backgroundColor = 'transparent';
                    sheetCanvas.style.backgroundImage = 'none';
                    bgImageContainer.style.display = 'none';
                } else if (bgType === 'color') {
                    // ìƒ‰ìƒ íƒ€ì…: ë‹¨ìƒ‰ ë˜ëŠ” ê·¸ë¼ë°ì´ì…˜
                    sheetCanvas.style.backgroundImage = 'none';
                    if (sheetConfig.decoration.background.colorType === 'gradient') {
                        sheetCanvas.style.background = `linear-gradient(to bottom, ${sheetConfig.decoration.background.colorGradientStart}, ${sheetConfig.decoration.background.colorGradientEnd})`;
                        sheetCanvas.style.backgroundColor = 'transparent';
                    } else {
                        sheetCanvas.style.background = '';
                        sheetCanvas.style.backgroundColor = sheetConfig.decoration.background.color;
                    }
                    bgImageContainer.style.display = 'none';
                } else if (bgType === 'image' && sheetConfig.decoration.background.imageUrl) {
                    // ë² ì´ìŠ¤ ìƒ‰ìƒ/ê·¸ë¼ë°ì´ì…˜ ì„¤ì •
                    sheetCanvas.style.backgroundImage = 'none';
                    if (sheetConfig.decoration.background.baseType === 'gradient') {
                        sheetCanvas.style.background = `linear-gradient(to bottom, ${sheetConfig.decoration.background.gradientStart}, ${sheetConfig.decoration.background.gradientEnd})`;
                        sheetCanvas.style.backgroundColor = 'transparent';
                    } else {
                        sheetCanvas.style.background = '';
                        sheetCanvas.style.backgroundColor = sheetConfig.decoration.background.baseColor;
                    }
                    
                    // ë°°ê²½ ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ ì„¤ì •
                    bgImageContainer.style.display = 'block';
                    bgImageContainer.style.position = 'absolute';
                    bgImageContainer.style.top = '0';
                    bgImageContainer.style.left = '0';
                    bgImageContainer.style.width = '100%';
                    bgImageContainer.style.height = '100%';
                    bgImageContainer.style.backgroundImage = `url(${sheetConfig.decoration.background.imageUrl})`;
                    bgImageContainer.style.backgroundSize = `${sheetConfig.decoration.background.imageScale}%`;
                    bgImageContainer.style.backgroundPosition = `${sheetConfig.decoration.background.imageX}px ${sheetConfig.decoration.background.imageY}px`;
                    bgImageContainer.style.backgroundRepeat = 'no-repeat';
                    bgImageContainer.style.opacity = sheetConfig.decoration.background.imageOpacity / 100;
                    bgImageContainer.style.pointerEvents = 'none'; // í´ë¦­ ì´ë²¤íŠ¸ ì°¨ë‹¨
                } else {
                    bgImageContainer.style.display = 'none';
                }
            } else {
                sheetCanvas.style.backgroundColor = 'white';
                sheetCanvas.style.backgroundImage = 'none';
                bgImageContainer.style.display = 'none';
            } 

            // 2. ì „ì‹  ì´ë¯¸ì§€
            if (sheetConfig.baseImage.url) {
                baseImageElement.src = sheetConfig.baseImage.url;
                baseImageContainer.style.left = `${sheetConfig.baseImage.x}px`;
                baseImageContainer.style.top = `${sheetConfig.baseImage.y}px`;
                baseImageContainer.style.transformOrigin = 'top left';
                baseImageContainer.style.transform = `scale(${sheetConfig.baseImage.scale})`;
            } else {
                baseImageElement.src = '';
            }

            // 4. í‘œì • ê·¸ë¦¬ë“œ
            gridContainer.style.left = `${sheetConfig.grid.x}px`;
            gridContainer.style.top = `${sheetConfig.grid.y}px`;
            
            const itemWidth = sheetConfig.faceBox.w;
            gridContainer.style.gridTemplateColumns = `repeat(${sheetConfig.grid.columns}, ${itemWidth}px)`;
            gridContainer.style.gap = `${sheetConfig.grid.gap}px`;

            // 5. í‘œì • 'ì°½ë¬¸' ë° 'ìŠ¤í”„ë¼ì´íŠ¸' ìƒì„±
            gridContainer.innerHTML = '';
            sheetConfig.grid.urls.forEach(faceUrl => {
                const faceWindow = document.createElement('div');
                faceWindow.className = 'face-window';
                if (sheetConfig.grid.roundCorners) {
                    faceWindow.classList.add('rounded');
                }
                
                faceWindow.style.width = `${sheetConfig.faceBox.w}px`;
                faceWindow.style.height = `${sheetConfig.faceBox.h}px`;

                const faceSprite = document.createElement('img');
                faceSprite.className = 'face-sprite';
                faceSprite.src = faceUrl;
                
                faceSprite.style.left = `-${sheetConfig.faceBox.x}px`;
                faceSprite.style.top = `-${sheetConfig.faceBox.y}px`;
                
                const faceSpriteScale = sheetConfig.grid.itemScale;
                faceSprite.style.transform = `scale(${faceSpriteScale})`;

                faceWindow.appendChild(faceSprite);
                gridContainer.appendChild(faceWindow);
            });

            // 6. ê¾¸ë¯¸ê¸° ìš”ì†Œ ë Œë”ë§
            // ê¸°ì¡´ ê¾¸ë¯¸ê¸° ìš”ì†Œ ì œê±°
            const existingDecorations = sheetCanvas.querySelectorAll('.decoration-element');
            existingDecorations.forEach(el => el.remove());

            if (sheetConfig.decoration.enabled) {
                
                // --- [ì‹œì‘] ìºë¦­í„° ì´ë¦„ ---
                if (sheetConfig.decoration.characterName.text) {
                    const nameEl = document.createElement('div');
                    nameEl.className = 'decoration-element character-name';
                    nameEl.textContent = sheetConfig.decoration.characterName.text;

                    const nameStyle = sheetConfig.decoration.characterName;
                    const useFont = nameStyle.useCustomFont ? nameStyle.fontFamily : sheetConfig.decoration.globalFont.fontFamily;

                    // 1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì •ì˜
                    let css = `
                        position: absolute;
                        top: ${nameStyle.y}px;
                        left: ${nameStyle.x}px;
                        font-size: ${nameStyle.fontSize}px;
                        font-family: '${useFont}', Arial, sans-serif;
                        font-weight: ${nameStyle.fontWeight};
                        color: ${nameStyle.color};
                        text-align: ${nameStyle.textAlign};
                        white-space: nowrap;
                        z-index: 100;
                    `;

                    // 2. ì™¸ê³½ì„  ì ìš©
                    if (nameStyle.stroke.enabled) {
                        css += `
                            -webkit-text-stroke-width: ${nameStyle.stroke.width}px;
                            -webkit-text-stroke-color: ${nameStyle.stroke.color};
                            paint-order: stroke fill;
                            -webkit-paint-order: stroke fill;
                        `;
                    }

                    // 3. ê·¸ë¦¼ì ì ìš©
                    if (nameStyle.shadow.enabled) {
                        css += `
                            text-shadow: ${nameStyle.shadow.x}px ${nameStyle.shadow.y}px ${nameStyle.shadow.blur}px ${nameStyle.shadow.color};
                        `;
                    } else {
                        css += ` text-shadow: none; `;
                    }

                    // ìµœì¢… ìŠ¤íƒ€ì¼ ì ìš©
                    nameEl.style.cssText = css;
                    sheetCanvas.appendChild(nameEl);
                }
                // --- [ë] ìºë¦­í„° ì´ë¦„ ---

                // --- [ì‹œì‘] ìºë¦­í„° ì„¤ëª… ---
                if (sheetConfig.decoration.characterDescription.text) {
                    const descEl = document.createElement('div');
                    descEl.className = 'decoration-element character-description';
                    descEl.textContent = sheetConfig.decoration.characterDescription.text;

                    const descStyle = sheetConfig.decoration.characterDescription;
                    const useFont = descStyle.useCustomFont ? descStyle.fontFamily : sheetConfig.decoration.globalFont.fontFamily;

                    descEl.style.cssText = `
                        position: absolute;
                        top: ${descStyle.y}px;
                        left: ${descStyle.x}px;
                        font-size: ${descStyle.fontSize}px;
                        font-family: '${useFont}', Arial, sans-serif;
                        font-weight: ${descStyle.fontWeight};
                        color: ${descStyle.color};
                        text-align: ${descStyle.textAlign};
                        white-space: pre-wrap;
                        z-index: 100;
                    `;
                    sheetCanvas.appendChild(descEl);
                }
                // --- [ë] ìºë¦­í„° ì„¤ëª… ---


                // ì›Œí„°ë§ˆí¬
                if (sheetConfig.decoration.watermark.text) {
                    const watermarkEl = document.createElement('div');
                    watermarkEl.className = 'decoration-element watermark';
                    watermarkEl.textContent = sheetConfig.decoration.watermark.text;

                    const wmStyle = sheetConfig.decoration.watermark;
                    const globalFont = sheetConfig.decoration.globalFont.fontFamily;

                    // 1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì •ì˜
                    let css = `
                        position: absolute;
                        top: ${wmStyle.y}px;
                        left: ${wmStyle.x}px;
                        font-size: ${wmStyle.fontSize}px;
                        font-family: '${globalFont}', Arial, sans-serif;
                        font-weight: ${wmStyle.fontWeight};
                        color: ${wmStyle.color};
                        z-index: 100;
                        white-space: nowrap;
                    `;

                    // 2. ì™¸ê³½ì„  ì ìš©
                    if (wmStyle.stroke.enabled) {
                        css += `
                            -webkit-text-stroke-width: ${wmStyle.stroke.width}px;
                            -webkit-text-stroke-color: ${wmStyle.stroke.color};
                            paint-order: stroke fill;
                            -webkit-paint-order: stroke fill;
                        `;
                    }

                    // 3. ê·¸ë¦¼ì ì ìš©
                    if (wmStyle.shadow.enabled) {
                        css += `
                            text-shadow: ${wmStyle.shadow.x}px ${wmStyle.shadow.y}px ${wmStyle.shadow.blur}px ${wmStyle.shadow.color};
                        `;
                    } else {
                        css += ` text-shadow: none; `;
                    }

                    watermarkEl.style.cssText = css;
                    sheetCanvas.appendChild(watermarkEl);
                }

                // ë¡œê³ 
                if (sheetConfig.decoration.logo.url) {
                    const logoEl = document.createElement('img');
                    logoEl.className = 'decoration-element logo';
                    logoEl.src = sheetConfig.decoration.logo.url;

                    logoEl.style.cssText = `
                        position: absolute;
                        left: ${sheetConfig.decoration.logo.x}px;
                        top: ${sheetConfig.decoration.logo.y}px;
                        max-width: ${sheetConfig.decoration.logo.maxWidth}px;
                        max-height: ${sheetConfig.decoration.logo.maxWidth}px;
                        z-index: 100;
                    `;
                    sheetCanvas.appendChild(logoEl);
                }

                // í‘œì • ì´ë¦„
                if (sheetConfig.decoration.expressionLabels.enabled && sheetConfig.decoration.expressionLabels.names.length > 0) {
                    const labels = sheetConfig.decoration.expressionLabels.names;
                    const exprStyle = sheetConfig.decoration.expressionLabels;

                    // ê·¸ë¦¬ë“œ ì„¤ì • ê³„ì‚°
                    const columns = sheetConfig.grid.columns;
                    const itemWidth = sheetConfig.faceBox.w;
                    const itemHeight = sheetConfig.faceBox.h;
                    const gap = sheetConfig.grid.gap;
                    const gridX = sheetConfig.grid.x;
                    const gridY = sheetConfig.grid.y;

                    for (let i = 0; i < Math.min(labels.length, sheetConfig.grid.urls.length); i++) {
                        if (labels[i]) {
                            // ê·¸ë¦¬ë“œ ë‚´ ìœ„ì¹˜ ê³„ì‚°
                            const row = Math.floor(i / columns);
                            const col = i % columns;

                            // ê° í‘œì • ë°•ìŠ¤ì˜ ì ˆëŒ€ ìœ„ì¹˜ ê³„ì‚°
                            const boxX = gridX + col * (itemWidth + gap);
                            const boxY = gridY + row * (itemHeight + gap);
                            const boxCenterX = boxX + itemWidth / 2;
                            const boxBottomY = boxY + itemHeight;

                            const labelEl = document.createElement('div');
                            labelEl.className = 'decoration-element expression-label';
                            labelEl.textContent = labels[i];

                            const globalFont = sheetConfig.decoration.globalFont.fontFamily;

                            // 1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì •ì˜
                            let transformValue = 'translateX(-50%)';
                            let leftPosition = boxCenterX + exprStyle.offsetX;

                            // ì •ë ¬ì— ë”°ë¥¸ ìœ„ì¹˜ ì¡°ì •
                            if (exprStyle.textAlign === 'left') {
                                transformValue = 'none';
                                leftPosition = boxX + exprStyle.offsetX;
                            } else if (exprStyle.textAlign === 'right') {
                                transformValue = 'translateX(-100%)';
                                leftPosition = boxX + itemWidth + exprStyle.offsetX;
                            }

                            let css = `
                                position: absolute;
                                left: ${leftPosition}px;
                                top: ${boxBottomY + exprStyle.offsetY}px;
                                transform: ${transformValue};
                                font-size: ${exprStyle.fontSize}px;
                                font-family: '${globalFont}', Arial, sans-serif;
                                font-weight: ${exprStyle.fontWeight};
                                color: ${exprStyle.color};
                                text-align: ${exprStyle.textAlign};
                                white-space: nowrap;
                                z-index: 101;
                            `;

                            // 2. ì™¸ê³½ì„  ì ìš©
                            if (exprStyle.stroke.enabled) {
                                css += `
                                    -webkit-text-stroke-width: ${exprStyle.stroke.width}px;
                                    -webkit-text-stroke-color: ${exprStyle.stroke.color};
                                    paint-order: stroke fill;
                                    -webkit-paint-order: stroke fill;
                                `;
                            }

                            // 3. ê·¸ë¦¼ì ì ìš©
                            if (exprStyle.shadow.enabled) {
                                css += `
                                    text-shadow: ${exprStyle.shadow.x}px ${exprStyle.shadow.y}px ${exprStyle.shadow.blur}px ${exprStyle.shadow.color};
                                `;
                            } else {
                                css += ` text-shadow: none; `;
                            }

                            labelEl.style.cssText = css;
                            sheetCanvas.appendChild(labelEl);
                        }
                    }
                }
            }

            // ì„¤ì • ìë™ ì €ì¥
            saveSettings();
        }

        // --- 4. í‘œì • ê·¸ë¦¬ë“œ ë“œë˜ê·¸ ì´ë™ ë¡œì§ ---
        
        let isDraggingGrid = false;
        let dragStartX, dragStartY;
        let gridStartX, gridStartY;

        gridContainer.addEventListener('mousedown', (e) => {
            isDraggingGrid = true;
            gridContainer.style.cursor = 'grabbing';
            dragStartX = e.clientX;
            dragStartY = e.clientY;
            gridStartX = sheetConfig.grid.x;
            gridStartY = sheetConfig.grid.y;
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDraggingGrid) return;
            const deltaX = e.clientX - dragStartX;
            const deltaY = e.clientY - dragStartY;
            let newGridX = gridStartX + deltaX;
            let newGridY = gridStartY + deltaY;

            // í‘œì •ì‹œíŠ¸ê°€ ì‹œíŠ¸ ì˜ì—­ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ ì œì•½
            const gridWidth = sheetConfig.grid.columns * sheetConfig.faceBox.w +
                             (sheetConfig.grid.columns - 1) * sheetConfig.grid.gap;
            const gridHeight = Math.ceil(sheetConfig.grid.urls.length / sheetConfig.grid.columns) * sheetConfig.faceBox.h +
                              (Math.ceil(sheetConfig.grid.urls.length / sheetConfig.grid.columns) - 1) * sheetConfig.grid.gap;

            newGridX = Math.max(0, Math.min(newGridX, sheetConfig.sheet.width - gridWidth));
            newGridY = Math.max(0, Math.min(newGridY, sheetConfig.sheet.height - gridHeight));

            sheetConfig.grid.x = newGridX;
            sheetConfig.grid.y = newGridY;

            document.getElementById('grid-x').value = newGridX.toFixed(0);
            document.getElementById('grid-y').value = newGridY.toFixed(0);
            document.getElementById('grid-x-slider').value = newGridX.toFixed(0);
            document.getElementById('grid-y-slider').value = newGridY.toFixed(0);

            gridContainer.style.left = `${newGridX}px`;
            gridContainer.style.top = `${newGridY}px`;
        });

        document.addEventListener('mouseup', () => {
            isDraggingGrid = false;
            gridContainer.style.cursor = 'move';
        });

        // --- 5. ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

        document.getElementById('download-btn').addEventListener('click', () => {
            const target = document.getElementById('sheet-canvas');

            // ì›ë³¸ ìƒíƒœ ì €ì¥
            const originalBackgroundColor = target.style.backgroundColor;
            const originalBackgroundImage = target.style.backgroundImage;
            const originalBackground = target.style.background;
            const originalBorder = target.style.border;
            const originalBoxShadow = target.style.boxShadow;
            const originalTransform = target.style.transform;

            // ë°°ê²½ ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ ì›ë³¸ ìƒíƒœ ì €ì¥
            const bgImgContainer = document.getElementById('bg-image-container');
            const originalBgImgDisplay = bgImgContainer ? bgImgContainer.style.display : '';

            // í…ìŠ¤íŠ¸ ìš”ì†Œë“¤ì˜ ì›ë³¸ ìŠ¤íƒ€ì¼ ì €ì¥
            const textElements = target.querySelectorAll('.decoration-element');
            const originalStyles = [];
            textElements.forEach(el => {
                originalStyles.push({
                    element: el,
                    background: el.style.background,
                    webkitBackgroundClip: el.style.webkitBackgroundClip,
                    backgroundClip: el.style.backgroundClip,
                    color: el.style.color
                });
            });

            // ë‹¤ìš´ë¡œë“œ ì „ì— ìŠ¤ì¼€ì¼, í…Œë‘ë¦¬, ê·¸ë¦¼ì ì œê±°
            target.style.transform = 'none';
            target.style.border = 'none';
            target.style.boxShadow = 'none';

            // ë°°ê²½ ì„¤ì •
            if (sheetConfig.decoration.enabled) {
                const bgType = sheetConfig.decoration.background.type;

                if (bgType === 'transparent') {
                    target.style.backgroundImage = 'none';
                    target.style.backgroundColor = 'transparent';
                    if (bgImgContainer) {
                        bgImgContainer.style.display = 'none';
                    }
                } else if (bgType === 'color') {
                    if (sheetConfig.decoration.background.colorType === 'gradient') {
                        const gradientCSS = `linear-gradient(to bottom, ${sheetConfig.decoration.background.colorGradientStart}, ${sheetConfig.decoration.background.colorGradientEnd})`;
                        target.style.backgroundImage = gradientCSS;
                        target.style.backgroundColor = 'transparent';
                    } else {
                        target.style.backgroundImage = 'none';
                        target.style.backgroundColor = sheetConfig.decoration.background.color;
                    }
                    if (bgImgContainer) {
                        bgImgContainer.style.display = 'none';
                    }
                } else if (bgType === 'image' && sheetConfig.decoration.background.imageUrl) {
                    // ì´ë¯¸ì§€ ë°°ê²½ì˜ ê²½ìš° ë² ì´ìŠ¤ ìƒ‰ìƒ/ê·¸ë¼ë°ì´ì…˜ ì ìš©
                    if (sheetConfig.decoration.background.baseType === 'gradient') {
                        const gradientCSS = `linear-gradient(to bottom, ${sheetConfig.decoration.background.gradientStart}, ${sheetConfig.decoration.background.gradientEnd})`;
                        target.style.backgroundImage = gradientCSS;
                        target.style.backgroundColor = 'transparent';
                    } else {
                        target.style.backgroundImage = 'none';
                        target.style.backgroundColor = sheetConfig.decoration.background.baseColor;
                    }
                    // ë°°ê²½ ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆëŠ” ì¼œì§„ ìƒíƒœë¡œ ìœ ì§€ (html2canvasê°€ ìº¡ì²˜)
                    if (bgImgContainer) {
                        bgImgContainer.style.display = 'block';
                    }
                }
            } else {
                target.style.backgroundImage = 'none';
                target.style.backgroundColor = 'white';
                if (bgImgContainer) {
                    bgImgContainer.style.display = 'none';
                }
            }

            html2canvas(target, {
                backgroundColor: null,
                useCORS: true,
                logging: false,
                width: sheetConfig.sheet.width,
                height: sheetConfig.sheet.height,
                scale: 1,
                allowTaint: true
            }).then(canvas => {
                // ì›ë³¸ ìƒíƒœ ë³µì›
                target.style.backgroundColor = originalBackgroundColor;
                target.style.backgroundImage = originalBackgroundImage;
                target.style.background = originalBackground;
                target.style.transform = originalTransform;
                target.style.border = originalBorder;
                target.style.boxShadow = originalBoxShadow;

                // ë°°ê²½ ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ ë³µì›
                if (bgImgContainer) {
                    bgImgContainer.style.display = originalBgImgDisplay;
                }

                // í…ìŠ¤íŠ¸ ìš”ì†Œë“¤ ì›ë³¸ ìŠ¤íƒ€ì¼ ë³µì›
                originalStyles.forEach(item => {
                    item.element.style.background = item.background;
                    item.element.style.webkitBackgroundClip = item.webkitBackgroundClip;
                    item.element.style.backgroundClip = item.backgroundClip;
                    item.element.style.color = item.color;
                });

                const imageSrc = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = imageSrc;
                link.download = 'character_sheet.png';

                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }).catch(err => {
                console.error("ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", err);
                alert("ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");

                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ì›ë³¸ ìƒíƒœ ë³µì›
                target.style.backgroundColor = originalBackgroundColor;
                target.style.backgroundImage = originalBackgroundImage;
                target.style.background = originalBackground;
                target.style.transform = originalTransform;
                target.style.border = originalBorder;
                target.style.boxShadow = originalBoxShadow;

                // ë°°ê²½ ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ ë³µì›
                if (bgImgContainer) {
                    bgImgContainer.style.display = originalBgImgDisplay;
                }

                originalStyles.forEach(item => {
                    item.element.style.background = item.background;
                    item.element.style.webkitBackgroundClip = item.webkitBackgroundClip;
                    item.element.style.backgroundClip = item.backgroundClip;
                    item.element.style.color = item.color;
                });
            });
        });

        // --- ì´ˆê¸° ë Œë”ë§ ---
        // ê¸°ë³¸ í°íŠ¸ ë¡œë“œ (ì²« ë²ˆì§¸ í°íŠ¸ ê¸°ë³¸ê°’)
        const defaultFontElement = document.getElementById('global-font-list');
        if (defaultFontElement) {
            const defaultFont = defaultFontElement.value;
            if (fonts[defaultFont]) {
                loadGlobalFont(fonts[defaultFont]);
                sheetConfig.decoration.globalFont.fontFamily = defaultFont;
            }
        }

        // ì¥ì‹ ìš”ì†Œë“¤ì˜ ìµœëŒ€ê°’ ì´ˆê¸° ì„¤ì •
        updateDecorationMaxValues();

        renderPreview();
        inputs.forEach(input => {
             if (input.type === 'number') {
                const sliderInput = document.getElementById(input.id + '-slider');
                if (sliderInput) {
                    sliderInput.value = input.value;
                }
             }
        });
        
        // (v8) ìƒˆë¡œ ì¶”ê°€ëœ ìŠ¬ë¼ì´ë”ë“¤ë„ ì´ˆê¸°í™”
        const decorationSliders = [
            'name-stroke-width',
            'name-shadow-x', 'name-shadow-y', 'name-shadow-blur',
            'watermark-stroke-width',
            'watermark-shadow-x', 'watermark-shadow-y', 'watermark-shadow-blur'
        ];
        decorationSliders.forEach(id => {
            const numberInput = document.getElementById(id);
            if (numberInput) {
                const sliderInput = document.getElementById(id + '-slider');
                if (sliderInput) {
                    sliderInput.value = numberInput.value;
                }
            }
        });
        // (v8) í† ê¸€ ìƒíƒœì— ë”°ë¼ ì˜µì…˜ íŒ¨ë„ ì´ˆê¸°í™”
        document.getElementById('name-stroke-options').style.display =
            document.getElementById('name-stroke-enable').checked ? 'block' : 'none';
        document.getElementById('name-shadow-options').style.display =
            document.getElementById('name-shadow-enable').checked ? 'block' : 'none';

        // ì›Œí„°ë§ˆí¬ í† ê¸€ ì´ˆê¸°í™”
        document.getElementById('watermark-stroke-options').style.display =
            document.getElementById('watermark-stroke-enable').checked ? 'block' : 'none';
        document.getElementById('watermark-shadow-options').style.display =
            document.getElementById('watermark-shadow-enable').checked ? 'block' : 'none';

        // í‘œì • ì´ë¦„ í† ê¸€ ì´ˆê¸°í™”
        document.getElementById('expression-labels-settings').style.display =
            document.getElementById('enable-expression-labels').checked ? 'block' : 'none';
        document.getElementById('expr-stroke-options').style.display =
            document.getElementById('expr-stroke-enable').checked ? 'block' : 'none';
        document.getElementById('expr-shadow-options').style.display =
            document.getElementById('expr-shadow-enable').checked ? 'block' : 'none';

        // --- ì„¤ì • ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸ ---
        document.getElementById('reset-settings-btn').addEventListener('click', resetSettings);

        // --- í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ì„¤ì • ë³µì› ---
        window.addEventListener('DOMContentLoaded', () => {
            if (loadSettings()) {
                console.log('ì €ì¥ëœ ì„¤ì •ì„ ë³µì›í–ˆìŠµë‹ˆë‹¤.');
                // UI ìš”ì†Œë“¤ì„ ë³µì›ëœ ì„¤ì •ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                document.getElementById('sheet-width').value = sheetConfig.sheet.width;
                document.getElementById('sheet-width-slider').value = sheetConfig.sheet.width;
                document.getElementById('sheet-height').value = sheetConfig.sheet.height;
                document.getElementById('sheet-height-slider').value = sheetConfig.sheet.height;
                document.getElementById('preview-scale').value = Math.round(sheetConfig.previewScale * 100);
                document.getElementById('preview-scale-slider').value = Math.round(sheetConfig.previewScale * 100);

                document.getElementById('face-box-x').value = sheetConfig.faceBox.x;
                document.getElementById('face-box-x-slider').value = sheetConfig.faceBox.x;
                document.getElementById('face-box-y').value = sheetConfig.faceBox.y;
                document.getElementById('face-box-y-slider').value = sheetConfig.faceBox.y;
                document.getElementById('face-box-w').value = sheetConfig.faceBox.w;
                document.getElementById('face-box-w-slider').value = sheetConfig.faceBox.w;
                document.getElementById('face-box-h').value = sheetConfig.faceBox.h;
                document.getElementById('face-box-h-slider').value = sheetConfig.faceBox.h;

                document.getElementById('grid-x').value = sheetConfig.grid.x;
                document.getElementById('grid-x-slider').value = sheetConfig.grid.x;
                document.getElementById('grid-y').value = sheetConfig.grid.y;
                document.getElementById('grid-y-slider').value = sheetConfig.grid.y;
                document.getElementById('grid-columns').value = sheetConfig.grid.columns;
                document.getElementById('grid-columns-slider').value = sheetConfig.grid.columns;
                document.getElementById('grid-gap').value = sheetConfig.grid.gap;
                document.getElementById('grid-gap-slider').value = sheetConfig.grid.gap;
                document.getElementById('grid-item-scale').value = Math.round(sheetConfig.grid.itemScale * 100);
                document.getElementById('grid-item-scale-slider').value = Math.round(sheetConfig.grid.itemScale * 100);
                document.getElementById('round-face-boxes').checked = sheetConfig.grid.roundCorners;

                // ê¾¸ë¯¸ê¸° ì„¤ì • ë³µì›
                document.getElementById('enable-decoration').checked = sheetConfig.decoration.enabled;
                if (sheetConfig.decoration.enabled) {
                    document.getElementById('decoration-panel').classList.remove('inactive');
                }

                renderPreview();
            }
        });
    </script>
</body>
</html>
